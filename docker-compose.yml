version: '3.4'

services:
  api:
    container_name: api
    build:
      context: .
      target: dev
    image: eu.gcr.io/otomi-cloud/otomi-stack-api:${API_TAG:-latest}
    user: 1000:1000
    command: sh -c 'rm -rf /tmp/otomi-stack && npm run dev:docker'
    ports:
      - 8080:8080
    volumes:
      - ./:/app
      - ./test/core.yaml:/etc/otomi/core.yaml
      - .npm:/root/.npm
      - /tmp:/tmp
    environment:
      TOOLS_HOST: tools
