AppDrone:
  additionalProperties: false
  type: object
  properties:
    id:
      $ref: ../definitions.yaml#/idName
    rawValues:
      $ref: ../definitions.yaml#/rawValues
    enabled:
      type: boolean
      default: false
    values:
      x-externalDocsPath: docs/apps/drone
      additionalProperties: false
      type: object
      properties:
        sourceControl:
          title: Source control
          description: Provide data to connect to a remote git host. When none is provided Otomi will deploy and configure an in-cluster Gitea repo.
          type: object
          oneOf:
            - $ref: ../definitions.yaml#/offChoice
            - title: Bitbucket Cloud
              type: object
              required: [bitbucketCloud]
              properties:
                provider:
                  default: bitbucketcloud
                  enum:
                    - bitbucketcloud
                  type: string
                bitbucketCloud:
                  x-hideTitle: true
                  $ref: ../definitions.yaml#/droneGit
                  type: object
            - title: Bitbucket Server
              type: object
              required: [bitbucketServer]
              properties:
                provider:
                  default: bitbucketserver
                  enum:
                    - bitbucketserver
                  type: string
                bitbucketServer:
                  type: object
                  x-hideTitle: true
                  properties:
                    consumerKey:
                      type: string
                      x-secret: true
                    passwordKey:
                      type: string
                      x-secret: true
                    privateKey:
                      type: string
                      x-secret: true
                    server:
                      type: string
                    username:
                      type: string
                      x-secret: true
            - title: Gitea
              type: object
              required: [gitea]
              properties:
                provider:
                  default: gitea
                  enum:
                    - gitea
                  type: string
                gitea:
                  x-hideTitle: true
                  type: object
                  allOf:
                    - $ref: ../definitions.yaml#/droneGit
                    - properties:
                        server:
                          type: string
            - title: GitHub
              type: object
              required: [github]
              properties:
                provider:
                  default: github
                  enum:
                    - github
                  type: string
                github:
                  x-hideTitle: true
                  type: object
                  allOf:
                    - $ref: ../definitions.yaml#/droneGit
                    - properties:
                        server:
                          type: string
                          default: https://github.com
            - title: GitLab
              type: object
              required: [gitlab]
              properties:
                provider:
                  default: gitlab
                  enum:
                    - gitlab
                  type: string
                gitlab:
                  x-hideTitle: true
                  type: object
                  allOf:
                    - $ref: ../definitions.yaml#/droneGit
                    - properties:
                        server:
                          type: string
                          default: https://gitlab.com
            - title: Gogs
              type: object
              required: [gogs]
              properties:
                provider:
                  default: gogs
                  enum:
                    - gogs
                  type: string
                gogs:
                  x-hideTitle: true
                  type: object
                  properties:
                    server:
                      type: string
        adminUser:
          $ref: ../definitions.yaml#/wordCharacterPattern
          title: Admin username
          description: Username used to connect to remote git repo.
        adminToken:
          $ref: ../definitions.yaml#/wordCharacterPattern
          title: Admin token
          description: Token used by to connect to remote git repo.
          x-secret: true
        orgsFilter:
          $ref: ../definitions.yaml#/wordCharacterPattern
          title: Organization filter
          description: A comma separated list of git organisations that drone will manage.
        repo:
          $ref: ../definitions.yaml#/idName
          description: A git repository
        repoFilter:
          $ref: ../definitions.yaml#/wordCharacterPattern
          description: A comma separated list of git repositories that drone will manage.
        sharedSecret:
          description: A secret used by drone-admit-members plugin. https://docs.drone.io/runner/kubernetes/configuration/reference/drone-secret-plugin-token/
          type: string
          x-secret: 'randAlphaNum 32'
        githubAdmins:
          additionalProperties: false
          title: Github admin group
          type: object
          description: '[GitHub only] The name of a github group given admin access in drone.'
          properties:
            org:
              $ref: ../definitions.yaml#/wordCharacterPattern
              title: Organization
              description: The name of the github organisation
            team:
              $ref: ../definitions.yaml#/wordCharacterPattern
              title: Team
              description: The name of the team
            token:
              $ref: ../definitions.yaml#/wordCharacterPattern
              title: Token
              description: The oauth secret used to identify with the github oauth app.
        debug:
          type: boolean
          default: false
          description: Turns on debugging
        trace:
          type: boolean
          default: false
          description: Turns on tracing
        # image:
        #   type: object
        #   properties:
        #     agent:
        #       type: object
        #       properties:
        #         tag:
        #           $ref: ../definitions.yaml#/imageTag
        #           default: latest
        #         pullPolicy:
        #           description: Container pull policy.
        #           enum:
        #             - IfNotPresent
        #             - Always
        #           type: string
        #           default: Always
        #     server:
        #       type: object
        #       properties:
        #         tag:
        #           $ref: ../definitions.yaml#/imageTag
        #           default: 2.7.3
        #         pullPolicy:
        #           $ref: ../definitions.yaml#/imagePullPolicy
        resources:
          type: object
          properties:
            runner:
              title: Runner
              type: object
              properties:
                requests:
                  type: object
                  properties:
                    cpu:
                      title: CPU quantity
                      description: Requested compute resources for all the containers started by the runner (guaranteed), expressed in millicores.
                      type: integer
                    memory:
                      $ref: ../definitions.yaml#/quantityMem
                      description: Requested memory resources for all the containers started by the runner (guaranteed).
              required:
                - requests
            agent:
              type: object
              properties:
                limits:
                  type: object
                  properties:
                    cpu:
                      $ref: ../definitions.yaml#/quantityCpu
                      default: 200m
                    memory:
                      $ref: ../definitions.yaml#/quantityMem
                      default: 256Mi
                requests:
                  type: object
                  properties:
                    cpu:
                      $ref: ../definitions.yaml#/quantityCpu
                      default: 40m
                    memory:
                      $ref: ../definitions.yaml#/quantityMem
                      default: 32Mi
              required:
                - limits
                - requests
            server:
              type: object
              properties:
                limits:
                  type: object
                  properties:
                    cpu:
                      $ref: ../definitions.yaml#/quantityCpu
                      default: 200m
                    memory:
                      $ref: ../definitions.yaml#/quantityMem
                      default: 256Mi
                requests:
                  type: object
                  properties:
                    cpu:
                      $ref: ../definitions.yaml#/quantityCpu
                      default: 40m
                    memory:
                      $ref: ../definitions.yaml#/quantityMem
                      default: 32Mi
              required:
                - limits
                - requests
  required: [id]
