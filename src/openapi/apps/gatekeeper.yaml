AppGatekeeper:
  additionalProperties: false
  x-externalDocsPath: https://open-policy-agent.github.io/gatekeeper/website/docs/
  x-short: Policy Controller for Kubernetes
  description: Every organization has policies. Some are essential to meet governance and legal requirements. Others help ensure adherence to best practices and institutional conventions. Attempting to ensure compliance manually would be error-prone and frustrating. Automating policy enforcement ensures consistency, lowers development latency through immediate feedback, and helps with agility by allowing developers to operate independently without sacrificing compliance.
  title: Gatekeeper
  type: object
  properties:
    id:
      $ref: ../definitions.yaml#/idName
    enabled:
      default: false
      type: boolean
    rawValues:
      $ref: ../definitions.yaml#/rawValues
    shortcuts:
      description: Resource URL that lands the user in a place of interest within an app.
      type: array
      nullable: true
      items:
        $ref: ../definitions.yaml#/shortcut
    values:
      x-externalDocsPath: docs/console/apps/gatekeeper
      additionalProperties: false
      type: object
      properties:
        auditInterval:
          title: Audit interval
          description: The frequency with which audit is run.
          type: integer
          x-default: 60
        auditFromCache:
          title: Audit from cache
          description: Take the roster of resources to audit from the OPA cache
          type: boolean
          default: false
        constraintViolationsLimit:
          title: Constraint violations limit
          description: The maximum number of audit violations reported on a constraint.
          type: integer
          x-default: 20
        dataSync:
          type: array
          items:
            type: object
            properties:
              version:
                description: A k8s resource version. (i.e. 'serving.knative.dev')
                type: string
              kind:
                description: A k8s resource kind. (i.e. 'Service')
                type: string
              group:
                description: A k8s resource api group. (i.e. 'operator.knative.dev')
                type: string
            required: [kind, version]
          title: Data sync
          description: Additional resources that Gatekeeper policies will operate on, next to the ones Otomi already watches (core/Pod, apps/DaemonSet, apps/Deployment, apps/StatefulSet, batch/CronJob, batch/Job, serving.knative.dev/Service)
        disableValidatingWebhook:
          title: Disable validating webhook
          description: Disables Gatekeeper from blocking violating admission requests. Check the audit logs in Loki for violations.
          type: boolean
          default: true
        emitAuditEvents:
          title: Emit audit events
          description: Emit K8s events in gatekeeper namespace for audit violations.
          type: boolean
          default: false
        emitAdmissionEvents:
          title: Emit admission events
          description: Emit K8s events in gatekeeper namespace for admission violations.
          type: boolean
          default: false
        excludedNamespaces:
          type: array
          items:
            type: string
        logLevel:
          type: string
          default: 'INFO'
          enum:
            - TRACE
            - DEBUG
            - INFO
            - WARN
            - ERROR
        replicas:
          type: integer
          x-default: 1
        image:
          type: object
          properties:
            tag:
              $ref: ../definitions.yaml#/imageTag
              x-default: v3.4.0
            pullPolicy:
              $ref: ../definitions.yaml#/imagePullPolicy
        resources:
          type: object
          properties:
            audit:
              type: object
              properties:
                limits:
                  type: object
                  properties:
                    cpu:
                      $ref: ../definitions.yaml#/quantityCpu
                      x-default: 1000m
                    memory:
                      $ref: ../definitions.yaml#/quantityMem
                      x-default: 512Mi
                requests:
                  type: object
                  properties:
                    cpu:
                      $ref: ../definitions.yaml#/quantityCpu
                      x-default: 100m
                    memory:
                      $ref: ../definitions.yaml#/quantityMem
                      x-default: 256Mi
              required:
                - limits
                - requests
            controller:
              type: object
              properties:
                limits:
                  type: object
                  properties:
                    cpu:
                      $ref: ../definitions.yaml#/quantityCpu
                      x-default: 1000m
                    memory:
                      $ref: ../definitions.yaml#/quantityMem
                      x-default: 512Mi
                requests:
                  type: object
                  properties:
                    cpu:
                      $ref: ../definitions.yaml#/quantityCpu
                      x-default: 100m
                    memory:
                      $ref: ../definitions.yaml#/quantityMem
                      x-default: 256Mi
              required:
                - limits
                - requests
