AppIstio:
  additionalProperties: false
  type: object
  properties:
    id:
      $ref: ../definitions.yaml#/idName
    rawValues:
      $ref: ../definitions.yaml#/rawValues
    shortcuts:
      description: Resource URL that lands the user in a place of interest within an app.
      type: array
      nullable: true
      items:
        $ref: ../definitions.yaml#/shortcut
    values:
      x-externalDocsPath: docs/apps/istio
      additionalProperties: false
      type: object
      properties:
        tracing:
          $ref: '#/istioTracingProviders'
        autoscaling:
          additionalProperties: false
          type: object
          properties:
            egressgateway:
              $ref: ../definitions.yaml#/autoscaling
            ingressgateway:
              $ref: ../definitions.yaml#/autoscaling
            pilot:
              $ref: ../definitions.yaml#/autoscaling
        egressGateway:
          additionalProperties: false
          type: object
          properties:
            enabled:
              type: boolean
              default: false
        global:
          additionalProperties: false
          type: object
          properties:
            logging:
              type: object
              properties:
                level:
                  description: 'Comma separated list with key:value pairs as described here: https://istio.io/latest/docs/ops/diagnostic-tools/component-logging/'
                  type: string
            proxy:
              additionalProperties: false
              type: object
              properties:
                resources:
                  properties:
                    limits:
                      properties:
                        cpu:
                          $ref: '../definitions.yaml#/quantityCpu'
                          default: '1'
                        memory:
                          $ref: '../definitions.yaml#/quantityMem'
                          default: 1Gi
                    requests:
                      properties:
                        cpu:
                          $ref: '../definitions.yaml#/quantityCpu'
                          default: 20m
                        memory:
                          $ref: '../definitions.yaml#/quantityMem'
                          default: 80Mi
                  required:
                    - limits
                    - requests
        # meshConfig:
        #   type: object
        # properties:
        #   defaultConfig:
        #     type: object
        #     default:
        #       tracing:
        #         sampling: 0.1
        # image:
        #   type: object
        #   properties:
        #     tag:
        #       $ref: ../definitions.yaml#/imageTag
        #       default: 1.10.1
        #     pullPolicy:
        #       $ref: ../definitions.yaml#/imagePullPolicy
        resources:
          type: object
          properties:
            egressgateway:
              type: object
              properties:
                limits:
                  type: object
                  properties:
                    cpu:
                      $ref: ../definitions.yaml#/quantityCpu
                      default: '1'
                    memory:
                      $ref: ../definitions.yaml#/quantityMem
                      default: 256Mi
                requests:
                  type: object
                  properties:
                    cpu:
                      $ref: ../definitions.yaml#/quantityCpu
                      default: 100m
                    memory:
                      $ref: ../definitions.yaml#/quantityMem
                      default: 128Mi
              required:
                - limits
                - requests
            ingressgateway:
              type: object
              properties:
                limits:
                  type: object
                  properties:
                    cpu:
                      $ref: ../definitions.yaml#/quantityCpu
                      default: '1'
                    memory:
                      $ref: ../definitions.yaml#/quantityMem
                      default: 256Mi
                requests:
                  type: object
                  properties:
                    cpu:
                      $ref: ../definitions.yaml#/quantityCpu
                      default: 100m
                    memory:
                      $ref: ../definitions.yaml#/quantityMem
                      default: 128Mi
              required:
                - limits
                - requests
            pilot:
              type: object
              properties:
                limits:
                  type: object
                  properties:
                    cpu:
                      $ref: ../definitions.yaml#/quantityCpu
                      default: '2'
                    memory:
                      $ref: ../definitions.yaml#/quantityMem
                      default: 2Gi
                requests:
                  type: object
                  properties:
                    cpu:
                      $ref: ../definitions.yaml#/quantityCpu
                      default: 100m
                    memory:
                      $ref: ../definitions.yaml#/quantityMem
                      default: 128Mi
              required:
                - limits
                - requests
istioTracingProviders:
  type: object
  title: Tracing Providers
  oneOf:
    - title: Disabled
      x-hideTitle: true
      type: object
      properties:
        type:
          type: string
          enum:
            - disabled
          default: disabled
    - title: Default Envoy
      type: object
      description: Use Envoy OpenTelemetry (gRPC) Access Logs.
      x-hideTitle: true
      properties:
        defaultEnvoy:
          type: object
          properties:
            randomSamplingPercentage:
              type: string
              default: 100
        type:
          type: string
          enum:
            - defaultEnvoy
          default: defaultEnvoy
      required:
        - azure
        - type
    - title: OpenTelemetry
      type: object
      x-hideTitle: true
      description: Use Istio with OpenTelemetry tracing backend.
      properties:
        openTelemetry:
          type: object
          properties:
            randomSamplingPercentage:
              type: string
              default: 100
        type:
          type: string
          enum:
            - openTelemetry
          default: openTelemetry
      required:
        - openTelemetry
        - type
  required: [id]
