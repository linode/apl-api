AppLoki:
  additionalProperties: false
  x-externalDocsPath: https://grafana.com/oss/loki/
  x-short: 'Like Prometheus, but for logs.'
  description: Loki is a horizontally scalable, highly available, multi-tenant log aggregation system inspired by Prometheus. It is designed to be very cost effective and easy to operate. It does not index the contents of the logs, but rather a set of labels for each log stream.
  title: Loki
  type: object
  properties:
    id:
      $ref: ../definitions.yaml#/idName
    enabled:
      default: true
      type: boolean
    rawValues:
      $ref: ../definitions.yaml#/rawValues
    shortcuts:
      description: Resource URL that lands the user in a place of interest within an app.
      type: array
      nullable: true
      items:
        $ref: ../definitions.yaml#/shortcut
    values:
      x-externalDocsPath: docs/console/apps/loki
      additionalProperties: false
      allOf:
        - properties:
            adminPassword:
              type: string
              x-secret: 'randAlphaNum 20'
            persistence:
              additionalProperties: false
              properties:
                size:
                  x-default: 20Gi
                  type: string
            retention:
              additionalProperties: false
              nullable: true
              type: object
              properties:
                duration:
                  x-default: 24h
                  type: string
                period:
                  x-default: 24h
                  description: Should be a multiple of 24h. See https://grafana.com/docs/loki/latest/operations/storage/boltdb-shipper/.
                  type: string
              required:
                - duration
            v11StartDate:
              description: Set this to a date just after deployment in case of an upgrade. (Otomi started at v9 with filesystem.)
              title: Schema v11 start date
              type: string
          required:
            - adminPassword
      oneOf:
        - properties:
            storageType:
              type: string
              enum:
                - aws
              default: aws
            aws:
              description: 'No schema, but example found here: '
              type: object
              properties:
                s3:
                  $ref: ../definitions.yaml#/s3Url
                bucketnames:
                  type: string
                  title: Bucket names
                  description: A comma separated list of bucket names.
                dynamodb:
                  $ref: ../definitions.yaml#/s3Url
        - properties:
            storageType:
              type: string
              enum:
                - azure
              default: azure
            azure:
              description: Missing from docs but available with this schema.
              type: object
              properties:
                account_key:
                  type: string
                  x-secret: ''
                account_name:
                  type: string
                container_name:
                  type: string
              required:
                - account_key
                - account_name
                - container_name
        - properties:
            storageType:
              type: string
              enum:
                - bigtable
              default: bigtable
            bigtable:
              type: object
        - properties:
            storageType:
              type: string
              enum:
                - cassandra
              default: cassandra
            cassandra:
              type: object
        - properties:
            storageType:
              type: string
              enum:
                - gcs
              default: gcs
            gcs:
              type: object
        - properties:
            storageType:
              type: string
              enum:
                - swift
              default: swift
            swift:
              type: object
        - properties:
            storageType:
              type: string
              enum:
                - local
              default: local
            local:
              type: object
