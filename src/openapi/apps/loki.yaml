lokiValues:
  type: object
  properties:
    adminPassword:
      type: string
      x-secret: 'randAlphaNum 20'
    persistence:
      properties:
        size:
          x-default: 20Gi
          type: string
    retention:
      properties:
        duration:
          x-default: 24h
          type: string
        period:
          x-default: 24h
          description: Should be a multiple of 24h. See https://grafana.com/docs/loki/latest/operations/storage/boltdb-shipper/.
          type: string
      required:
        - duration
    v11StartDate:
      description: Set this to a date just after deployment in case of an upgrade. (Only needed when running v9 and wanting to upgrade schema.)
      title: Schema v11 start date
      type: string
  required:
    - adminPassword

lokiStorageProvider:
  title: Storage provider
  oneOf:
    - title: Filesystem
      description: Creates a k8s pvc.
      properties:
        storageType:
          type: string
          enum:
            - filesystem
          default: filesystem
    - title: AWS
      description: Amazon storage options.
      properties:
        storageType:
          type: string
          enum:
            - aws
          default: aws
        aws:
          properties:
            s3:
              $ref: ../definitions.yaml#/s3Url
            bucketnames:
              type: string
              title: Bucket names
              description: A comma separated list of bucket names.
            dynamodb:
              $ref: ../definitions.yaml#/s3Url
    - title: Azure
      description: Azure storage container.
      properties:
        storageType:
          type: string
          enum:
            - azure
          default: azure
        azure:
          description: Missing from docs but available with this schema.
          properties:
            account_key:
              type: string
              x-secret: ''
            account_name:
              type: string
            container_name:
              type: string
          required:
            - account_key
            - account_name
            - container_name
    - title: Bigtable
      description: 'Google Cloud Bigtable: nosql database service.'
      properties:
        storageType:
          type: string
          enum:
            - bigtable
          default: bigtable
        bigtable:
          type: object
    - title: Cassandra
      description: Apache Cassandra is an open source NoSQL distributed database.
      properties:
        storageType:
          type: string
          enum:
            - cassandra
          default: cassandra
        cassandra:
          type: object
    - title: GCS
      description: Google Cloud blob Storage.
      properties:
        storageType:
          type: string
          enum:
            - gcs
          default: gcs
        gcs:
          type: object
    - title: Swift
      description: OpenStack Object Storage.
      properties:
        storageType:
          type: string
          enum:
            - swift
          default: swift
        swift:
          type: object
    - title: Local
      description: Host volume.
      properties:
        storageType:
          type: string
          enum:
            - local
          default: local
        local:
          type: object

AppLoki:
  additionalProperties: false
  x-externalDocsPath: https://grafana.com/oss/loki/
  x-short: 'Like Prometheus, but for logs.'
  description: Loki is a horizontally scalable, highly available, multi-tenant log aggregation system inspired by Prometheus. It is designed to be very cost effective and easy to operate. It does not index the contents of the logs, but rather a set of labels for each log stream.
  x-info: |
    Loki aggregates all the container logs from the platform and stores them in a storage endpoint of choice (defaults to PVC). When Otomi is installed in multi-tenancy mode (see settings/otomi) it will split logs from team namespaces and make them available only to team members.

    Otomi provides Loki shortcuts to selections of logs based on interest.
  title: Loki
  type: object
  properties:
    id:
      $ref: ../definitions.yaml#/idName
    enabled:
      x-default: true
      type: boolean
    rawValues:
      $ref: ../definitions.yaml#/rawValues
    shortcuts:
      description: Resource URL that lands the user in a place of interest within an app.
      type: array
      nullable: true
      items:
        $ref: ../definitions.yaml#/shortcut
    values:
      type: object
      x-externalDocsPath: docs/console/apps/loki
      allOf:
        - $ref: '#/lokiValues'
        - $ref: '#/lokiStorageProvider'
