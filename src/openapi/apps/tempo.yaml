tempoValues:
  type: object
  properties:
    storage:
      $ref: '#/tempoStorageProvider'
    persistence:
      type: object
      properties:
        ingester:
          type: object
          properties:
            size:
              default: 10Gi
              type: string
    autoscaling:
      type: object
      properties:
        querier:
          type: object
          properties:
            enabled:
              type: boolean
              default: false
            maxReplicas:
              type: integer
              default: 3
            minReplicas:
              type: integer
              default: 1
            targetCPUUtilizationPercentage:
              type: integer
              default: 80
            targetMemoryUtilizationPercentage:
              type: integer
              default: 80
        distributor:
          type: object
          properties:
            enabled:
              type: boolean
              default: false
            maxReplicas:
              type: integer
              default: 3
            minReplicas:
              type: integer
              default: 1
            targetCPUUtilizationPercentage:
              type: integer
              default: 80
            targetMemoryUtilizationPercentage:
              type: integer
              default: 80
        queryFrontend:
          type: object
          properties:
            enabled:
              type: boolean
              default: false
            maxReplicas:
              type: integer
              default: 3
            minReplicas:
              type: integer
              default: 1
            targetCPUUtilizationPercentage:
              type: integer
              default: 80
            targetMemoryUtilizationPercentage:
              type: integer
              default: 80 
    resources:
      additionalProperties: false
      type: object
      properties:
        compactor:
          properties:
            limits:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 500m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 1Gi
            requests:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 100m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 256Mi
          required:
            - limits
            - requests
        ingester:
          properties:
            limits:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 500m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 1Gi
            requests:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 100m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 256Mi
          required:
            - limits
            - requests
        memcached:
          properties:
            limits:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 200m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 256Mi
            requests:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 50m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 64Mi
          required:
            - limits
            - requests
        querier:
          properties:
            limits:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 200m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 256Mi
            requests:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 50m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 64Mi
          required:
            - limits
            - requests
        distributor:
          properties:
            limits:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 200m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 256Mi
            requests:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 50m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 64Mi
          required:
            - limits
            - requests
        queryFrontend:
          properties:
            limits:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 200m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 256Mi
            requests:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 50m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 64Mi
          required:
            - limits
            - requests
        metricsGenerator:
          properties:
            limits:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 200m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 256Mi
            requests:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 50m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 64Mi
          required:
            - limits
            - requests

tempoStorageProvider:
  type: object
  title: Storage provider
  description: Select the preferred provider for storing logs.
  oneOf:
    - title: Local Minio
      type: object
      description: Select to use the in-cluster Minio instance.
      properties:
        type:
          type: string
          enum:
            - minioLocal
          default: minioLocal
    - title: Azure Blob
      type: object
      x-hideTitle: true
      properties:
        azure:
          type: object
          description: Select to store logs in Azure Blob storage.
          title: Azure blob (container) storage
          properties:
            accountKey:
              type: string
              x-secret: ''
            accountName:
              type: string
            containerName:
              type: string
          required:
            - accountKey
            - accountName
            - containerName
        type:
          type: string
          enum:
            - azure
          default: azure
      required:
        - azure
        - type
    - title: S3
      type: object
      x-hideTitle: true
      properties:
        s3:
          type: object
          title: S3
          description: Select to store logs in AWS S3 or S3 compatible blob storage.
          properties:
            bucket:
              type: string
              description: The name of the bucket.
              $ref: ../definitions.yaml#/wordCharacterPattern
            s3Url:
              type: string
              description: The full S3 URL.
              $ref: ../definitions.yaml#/wordCharacterPattern
            accessKeyId:
              type: string
              description: The ID of the access key. Optional if cloud provider is AWS.
              $ref: ../definitions.yaml#/wordCharacterPattern
            secretAccessKey:
              type: string
              description: The secret of the access key. Optional if cloud provider is AWS.
              $ref: ../definitions.yaml#/wordCharacterPattern
              x-secret: true
          required:
            - bucket
            - s3Url
            - accessKeyId
            - secretAccessKey
        type:
          type: string
          enum:
            - s3
          default: s3
      required:
        - s3
        - type
    # - title: gcs
    #   type: object
    #   x-hideTitle: true
    #   properties:
    #     gcs:
    #       type: object
    #       title: Google Object Storage
    #       description: Select to store backups in Google Object Storage.
    #       properties:
    #         bucket:
    #           type: string
    #           description: Name of the bucket.
    #           $ref: ../definitions.yaml#/wordCharacterPattern
    #         project:
    #           description: Big Table Project.
    #           $ref: ../definitions.yaml#/wordCharacterPattern
    #         instance:
    #           description: Big Table Instance.
    #           $ref: ../definitions.yaml#/wordCharacterPattern
    #       required:
    #         - bucket
    #         - project
    #         - instance
    #     type:
    #       type: string
    #       enum:
    #         - gcs
    #       default: gcs
    #   required:
    #     - gcs
    #     - type

AppTempo:
  additionalProperties: false
  type: object
  properties:
    id:
      $ref: ../definitions.yaml#/idName
    enabled:
      type: boolean
      default: true
    rawValues:
      $ref: ../definitions.yaml#/rawValues
    shortcuts:
      description: Resource URL that lands the user in a place of interest within an app.
      type: array
      nullable: true
      items:
        $ref: ../definitions.yaml#/shortcut
    values:
      type: object
      x-externalDocsPath: docs/apps/tempo
      $ref: '#/tempoValues'
  required: [id]
