AppVelero:
  additionalProperties: false
  type: object
  properties:
    id:
      $ref: ../definitions.yaml#/idName
    enabled:
      type: boolean
      default: false
    rawValues:
      $ref: ../definitions.yaml#/rawValues
    values:
      x-externalDocsPath: docs/apps/velero
      additionalProperties: false
      type: object
      properties:
        restic:
          title: Restic Integration
          description: Turn on Restic integration to take snapshots of persistent volumes when not using Amazon EBS Volumes, Azure Managed Disks or Google Persistent Disks.
          properties:
            enabled:
              type: boolean
              default: false
        cloud:
          $ref: '#/veleroCloudProvider'
        logLevel:
          description: Set log-level for the Velero pod.
          title: Log Level
          type: string
          default: info
          enum:
            - error
            - warn
            - info
            - debug
            - trace
        resources:
          additionalProperties: false
          type: object
          properties:
            limits:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 1000m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 512Mi
            requests:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 500m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 256Mi
          required:
            - limits
            - requests
  required: [id]

veleroCloudProvider:
  type: object
  title: Cloud provider
  description: Select your cloud provider.
  oneOf:
    - title: Custom
      type: object
      description: Select in case other options are not applicable
      properties:
        type:
          type: string
          enum:
            - custom
          default: custom
    - title: Azure
      # x-hideTitle: true
      type: object
      properties:
        azure:
          additionalProperties: false
          type: object
          title: Azure
          description: For clusters running in Azure.
          properties:
            resourceGroup:
              description: The resource group that contains the worker nodes (VMs and disks).
              type: string
            tenantId:
              description: The ID of the used Azure Tenant.
              $ref: ../definitions.yaml#/wordCharacterPattern
            subscriptionId:
              description: The ID of the used Azure Subscription.
              $ref: ../definitions.yaml#/wordCharacterPattern
            aadClientId:
              description: The ID of the Service Principal with permissions for disk and snapshot management.
              $ref: ../definitions.yaml#/wordCharacterPattern
            aadClientSecret:
              description: The password of the Service Principal.
              $ref: ../definitions.yaml#/wordCharacterPattern
              x-secret: true
            environment:
              x-hideTitle: true
              type: string
              enum:
                - AzurePublicCloud
                - AzureChinaCloud
                - AzureUSGovernment
                - AzureGermanCloud
              default: AzurePublicCloud
          required:
            - resourceGroup
            - environment
            - tenantId
            - subscriptionId
            - aadClientId
            - aadClientSecret
        type:
          type: string
          enum:
            - azure
          default: azure
      required:
        - azure
        - type
    - title: AWS
      x-hideTitle: true
      type: object
      properties:
        aws:
          additionalProperties: false
          type: object
          description: For clusters running in AWS.
          title: AWS
          properties:
            region:
              type: string
              description: The AWS region where the cluster worker nodes are running.
              $ref: ../definitions.yaml#/wordCharacterPattern
            accessKeyId:
              type: string
              description: The ID of the access key
              $ref: ../definitions.yaml#/wordCharacterPattern
            secretAccessKey:
              type: string
              description: The secret of the access key
              $ref: ../definitions.yaml#/wordCharacterPattern
              x-secret: true
          required:
            - region
            - accessKeyId
            - secretAccessKey
        type:
          type: string
          enum:
            - aws
          default: aws
      required:
        - aws
        - type
    - title: Google
      x-hideTitle: true
      type: object
      properties:
        google:
          additionalProperties: false
          type: object
          description: For clusters running in Google.
          title: Google
          properties:
            serviceAccount:
              type: string
              description: The IAM service account with permissions to manage snapshot resources in the GCP Project.
              $ref: ../definitions.yaml#/wordCharacterPattern
            project:
              type: string
              description: The name of the GCP project.
              $ref: ../definitions.yaml#/wordCharacterPattern
            saKeyJson:
              description: The Service Account Key (json)
              type: string
              x-secret: true
              x-formtype: textarea
          required:
            - saKeyJson
            - serviceAccount
            - project
        type:
          type: string
          enum:
            - google
          default: google
      required:
        - google
        - type
