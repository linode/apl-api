AppVelero:
  additionalProperties: false
  type: object
  properties:
    id:
      $ref: ../definitions.yaml#/idName
    enabled:
      type: boolean
      default: false
    rawValues:
      $ref: ../definitions.yaml#/rawValues
    values:
      x-externalDocsPath: docs/apps/velero
      type: object
      properties:
        cloud: 
          $ref: '#/veleroCloudProvider'
        storage: 
          $ref: '#/veleroStorageProvider'
        logLevel:
          description: Set log-level for the Velero pod.
          title: Log Level
          type: string
          default: info
          enum:
            - error
            - warn
            - info
            - debug
            - trace
        resources:
          type: object
          properties:
            limits:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 1000m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 512Mi
            requests:
              type: object
              properties:
                cpu:
                  $ref: ../definitions.yaml#/quantityCpu
                  default: 500m
                memory:
                  $ref: ../definitions.yaml#/quantityMem
                  default: 256Mi
          required:
            - limits
            - requests

veleroCloudProvider:
  title: Cloud provider
  description: Choose your cloud provider.
  oneOf:
    - title: Custom
      type: object
      description: For clusters not running in Azure or AWS (like on Vmware).
      properties:
        cloudProvider:
          type: string
          enum:
            - custom
          default: custom
    - title: Azure
      x-hideTitle: true
      type: object
      properties:
        azure:
          type: object
          title: Azure
          description: For clusters running in Azure.
          properties:
            environment:
              title: Environment
              description: An Azure environment.
              type: string
              enum:
                - AzurePublicCloud
                - AzureChinaCloud
                - AzureUSGovernment
                - AzureGermanCloud
            resourceGroup:
              description: The resource group that contains the worker nodes (VMs and disks).
              type: string
          required:
            - resourceGroup
            - environment
        cloudProvider:
          type: string
          enum:
            - azure
          default: azure
      required:
        - azure
        - cloudProvider
    - title: AWS
      x-hideTitle: true
      type: object
      properties:
        aws:
          type: object
          description: For clusters running in AWS.
          title: AWS
          properties:
            region:
              type: string
              description: The AWS region where the cluster worker nodes are running.
              $ref: ../definitions.yaml#/wordCharacterPattern
          required:
            - region
        cloudProvider:
          type: string
          enum:
            - aws
          default: aws
      required:
        - aws
        - cloudProvider

veleroStorageProvider:
  title: Storage provider
  description: Choose your storage backend.
  oneOf:
    - title: Local Minio
      type: object
      description: For using local cluster Minio instance.
      properties:
        storageProvider:
          type: string
          enum:
            - minioLocal
          default: minioLocal
    - title: Azure Blob
      type: object
      x-hideTitle: true
      properties:
        azureBlob:
          type: object
          description: For storing backups in Azure Blob storage
          title: Azure blob (container) storage
          properties:
            resourceGroup:
              description: Resource group of the storage account.
              $ref: ../definitions.yaml#/wordCharacterPattern
            storageAccount:
              description: The name of the Azure storage account.
              $ref: ../definitions.yaml#/wordCharacterPattern
            bucket:
              type: string
              description: Name of the blob container.
              $ref: ../definitions.yaml#/wordCharacterPattern
            tenantId:
              description: The used Azure Account Tenant ID.
              $ref: ../definitions.yaml#/wordCharacterPattern
            subscriptionId:
              description: The used Azure Subscription ID.
              $ref: ../definitions.yaml#/wordCharacterPattern
            aadClientId:
              description: The ID of the Service Principal with permissions to perform backups.
              $ref: ../definitions.yaml#/wordCharacterPattern
            aadClientSecret:
              description: The generated password of the Service Principal.
              $ref: ../definitions.yaml#/wordCharacterPattern
              x-secret: ''
          required:
            - tenantId
            - subscriptionId
            - aadClientId
            - aadClientSecret
            - resourceGroup
            - storageAccount
            - bucket
        storageProvider:
          type: string
          enum:
            - azureBlob
          default: azureBlob
      required:
        - azureBlob
        - storageProvider
    - title: S3
      type: object
      x-hideTitle: true
      properties:
        s3:
          type: object
          title: S3
          description: AWS S3 or S3 compatible blob storage.
          properties:
            bucket:
              type: string
              description: The name of the bucket
              $ref: ../definitions.yaml#/wordCharacterPattern
            s3Url:
              type: string
              description: S3 URL
              $ref: ../definitions.yaml#/wordCharacterPattern
            accessKeyId:
              type: string
              description: The ID of the access key
              $ref: ../definitions.yaml#/wordCharacterPattern
            secretAccessKey:
              type: string
              description: The secret of the access key
              $ref: ../definitions.yaml#/wordCharacterPattern
              x-secret: ''
          required:
            - accessKeyId
            - secretAccessKey
            - bucket
            - s3Url
        storageProvider:
          type: string
          enum:
            - s3
          default: s3
      required:
        - s3
        - storageProvider
