alerts:
  properties:
    drone:
      default: slack
      enum:
        - slack
        - msteams
      type: string
    email:
      additionalProperties: false
      properties:
        critical:
          $ref: '#/email'
          description: One or more email addresses (comma separated) for critical events.
        nonCritical:
          $ref: '#/email'
          description: One or more email addresses (comma separated) for non-critical events.
    groupInterval:
      default: 5m
      description: How long to wait before sending a notification about new alerts that are added to a group of alerts for which an initial notification has already been sent. (Usually ~5m or more.)
      type: string
    msteams:
      additionalProperties: false
      properties:
        highPrio:
          description: The low prio web hook.
          type: string
        lowPrio:
          description: The high prio web hook.
          type: string
    receivers:
      description: Notification receivers.
      items:
        enum:
          - slack
          - msteams
          - email
        type: string
      type: array
    repeatInterval:
      default: 3h
      description: How long to wait before sending a notification again if it has already been sent successfully for an alert. (Usually ~3h or more).
      type: string
    slack:
      additionalProperties: false
      properties:
        channel:
          default: mon-otomi
          description: The Slack channel for non-critical notifications.
          type: string
        channelCrit:
          default: mon-otomi
          description: The Slack channel for critical notifications.
          type: string
        url:
          $ref: '#/url'
          description: A Slack webhook URL.
annotations:
  $ref: '#/labelsAnnotations'
  description: A set of annotations.
azureMonitor:
  properties:
    appInsightsApiKey:
      description: An Azure AppInsights client secret (defaults to clientSecret).
      type: string
    appInsightsAppId:
      description: An Azure AppInsights client id (defaults to clientId).
      type: string
    clientId:
      description: An Azure client id.
      type: string
    clientSecret:
      description: An Azure client secret.
      type: string
    logAnalyticsClientId:
      description: An Azure client secret (defaults to clientSecret).
      type: string
    logAnalyticsClientSecret:
      description: An Azure client secret (defaults to clientSecret).
      type: string
    logAnalyticsTenantId:
      description: An Azure tenant id (defaults to tenantId).
      type: string
    logAnalyticsWorkspace:
      description: An Azure monitor log analytics workspace.
      type: string
cloud:
  description: A common cloud configuration.
  properties:
    clusters:
      additionalProperties: false
      patternProperties:
        ^[a-z-]+$:
          $ref: '#/cluster'
    domain:
      $ref: '#/domain'
  required:
    - domain
    - clusters
cluster:
  additionalProperties: false
  properties:
    apiName:
      description: Only used for API/UI to show in app.
      type: string
    apiServer:
      description: Used by kubectl for local deployment to target cluster.
      type: string
    dnsProvider:
      description: Only set it if you want DNS provider to be different than cloud provider of this cluster.
      enum:
        - azure
        - google
        - aws
      type: string
    dnsZones:
      description: Extra dns zones that the cluster can administer (see dns). Team services can use this to publish their URLs on.
      items:
        $ref: '#/domain'
      type: array
    domain:
      $ref: '#/domain'
      description: Base cloud domain for the cluster domain. Also added to list of dns zones in the Otomi Console.
    enabled:
      default: true
      type: boolean
    entrypoint:
      description: A Kubernetes API public IP address (onprem only).
      type: string
    k8sVersion:
      $ref: '#/k8sVersion'
    otomiVersion:
      default: latest
      description: 'Please pin this a valid release version found in the repo. Suggestion: try the most recent stable version.'
      type: string
    region:
      description: Dependent on provider.
      example:
        - europe-west4
        - eu-central-1
        - westeurope
      type: string
    vpcID:
      description: AWS only. If provided will override autodiscovery from metadata.
      type: string
  required:
    - apiServer
    - k8sVersion
    - otomiVersion
    - region
cpuQuantity:
  description: Amount of cores, or slice of cpu in millis.
  example:
    - '1'
    - 200m
  pattern: ^([0-9]+\.[0-9]{1,2})|([0-9]{2,3}m)?$
  type: string
domain:
  pattern: ^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$
  type: string
droneGit:
  properties:
    clientID:
      type: string
    clientSecretValue:
      type: string
email:
  pattern: ^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$
  type: string
env:
  additionalProperties: false
  nullable: true
  x-patternProperties:
    '[a-zA-Z_]{1,}[a-zA-Z0-9_]*':
      maxLength: 131072
      type: string
  title: Environment variables
externalSecret:
  oneOf:
    - properties:
        entries:
          items:
            description: A property name at vaultPath
            minItems: 1
            pattern: ^[a-zA-Z0-9_]*$
            type: string
            uniqueItems: true
          type: array
        type:
          default: generic
          enum:
            - generic
      required:
        - type
        - entries
      title: Generic
    - properties:
        dockerconfig:
          enum:
            - .dockerconfig.json
          readOnly: true
          type: string
        type:
          default: docker-registry
          enum:
            - docker-registry
          type: string
      required:
        - type
      title: Docker registry
    - properties:
        ca:
          default: ca.crt
          type: string
        crt:
          default: tls.crt
          type: string
        key:
          default: tls.key
          type: string
        type:
          default: tls
          enum:
            - tls
          type: string
      required:
        - type
        - crt
        - key
      title: TLS
  properties:
    id:
      readOnly: true
      type: string
    name:
      $ref: '#/subdomainType'
  required:
    - name
  type: object
hostPort:
  pattern: ^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9]):()([1-9]|[1-5]?[0-9]{2,4}|6[1-4][0-9]{3}|65[1-4][0-9]{2}|655[1-2][0-9]|6553[1-5])$
  type: string
idName:
  description: A lowercase name that starts with a letter and may contain dashes.
  pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
  type: string
image:
  additionalProperties: false
  properties:
    pullPolicy:
      default: IfNotPresent
      enum:
        - IfNotPresent
        - Always
      type: string
    repository:
      $ref: '#/repository'
    tag:
      default: latest
      type: string
  title: Container image
imageSimple:
  additionalProperties: false
  properties:
    pullPolicy:
      default: IfNotPresent
      enum:
        - IfNotPresent
        - Always
      type: string
    tag:
      type: string
  title: Container image
jobs:
  additionalProperties: false
  description: You may pass an array of Job objects. The Kubernetes API accepts a Job specification, which is meant for run-to-completion apps (e.g. batch Jobs).
  items:
    additionalProperties: false
    properties:
      enabled:
        default: true
        type: boolean
      env:
        $ref: '#/env'
        default:
          foo: bar
      files:
        default:
          foo: bar.log
        description: May mount files directly into the container. The mount path is /, so a user can specify anything that comes after it. E.g. foo/bar.log -> /foo/bar.log foo.log -> /foo.log
        patternProperties:
          ^(.*/)|[a-z-]+([^/]*)$:
            type: string
      image:
        $ref: '#/image'
      init:
        properties:
          env:
            $ref: '#/env'
          image:
            $ref: '#/image'
          script:
            $ref: '#/script'
          secrets:
            $ref: '#/secrets'
      name:
        default: foo
        description: Must be a unique name.
        pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
        type: string
      podSecurityContext:
        $ref: '#/podSecurityContext'
      resources:
        $ref: '#/resources'
      runPolicy:
        default: OnSpecChange
        description: |
          If runPolicy is set to 'Always', the job controller will always be re-deployed after a successful deployment with Helm.
          If runPolicy is set to 'OnSpecChange', the job controller will only be re-deployed if one changes this specification.
        enum:
          - Always
          - OnSpecChange
        type: string
      schedule:
        default: 0 1 * * *
        description: Must give a cron-type expression if the job-type is 'cronjob' (job.type).
        type: string
      script:
        $ref: '#/script'
      secrets:
        $ref: '#/secrets'
      ttlSecondsAfterFinished:
        default: 86400
        type: number
      type:
        default: Job
        enum:
          - Job
          - CronJob
        type: string
  required:
    - image
    - name
    - script
    - type
  type: array
k8sVersion:
  default: '1.19'
  description: The cluster k8s version. Otomi supports 2 minor versions backwards compatibility from the suggested default.
  enum:
    - '1.17'
    - '1.18'
    - '1.19'
  type: string
labels:
  $ref: '#/labelsAnnotations'
  description: A set of labels.
labelsAnnotations:
  additionalProperties: false
  x-patternProperties:
    ? ^((([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9]){1,253}\/)?([a-z0-9A-Z]+[a-z0-9A-Z-_.]+[a-z0-9A-Z]){1,63}$
    : pattern: ^((.){1,253}\/)?(.){1,63}$
      type: string
logLevel:
  default: info
  enum:
    - error
    - warn
    - info
    - debug
    - trace
  type: string
memoryQuantity:
  description: Amount of memory. Valid units are E|P|T|G|M|K|Ei|Pi|Ti|Gi|Mi|Ki.
  example:
    - 1Mi
    - 0.5M
  pattern: ^([0-9]+\.)?[0-9]+(E|P|T|G|M|K|Ei|Pi|Ti|Gi|Mi|Ki)?$
  type: string
podSecurityContext:
  properties:
    runAsGroup:
      default: 1001
      maximum": 65535
      minimum": 0
      type: integer
    runAsNonRoot:
      default: true
      type: boolean
    runAsUser:
      default: 1001
      maximum": 65535
      minimum": 0
      type: integer
portNumber:
  maximum: 32768
  minimum: 80
  type: number
rawValues:
  description: "May define value overrides for a chart. WARNING: these values currently have no schema and can't be validated as such, and may break deployment. You are on your own here."
  type: object
registry:
  pattern: ^[a-z0-9]+(?:[._-][a-z0-9]+)*$
  type: string
repoUrl:
  description: Path to a remote git repo without protocol. Will use https to access.
  pattern: ^(.+@)*([\w\d\.]+)(:[\d]+){0,1}/*(.*)$
  type: string
repository:
  description: A container image repository.
  pattern: ^[a-z0-9]+(?:[/._-]{1,2}[a-z0-9]+)*$
  type: string
resource:
  additionalProperties: false
  properties:
    cpu:
      $ref: '#/cpuQuantity'
    memory:
      $ref: '#/memoryQuantity'
  required:
    - cpu
    - memory
resources:
  additionalProperties: false
  description: Compute resources for containers.
  properties:
    limits:
      $ref: '#/resource'
      description: Requested resources (best effort).
    requests:
      $ref: '#/resource'
      description: Requested resources (guaranteed).
  title: Pod resources
scaling:
  description: Min and max number of replicas.
  properties:
    maxReplicas:
      type: number
    minReplicas:
      type: number
script:
  description: May specify a non-empty string containing an executable script.
  type: string
secret:
  oneOf:
    - properties:
        password:
          type: string
        server:
          $ref: '#/registry'
        type:
          default: docker-registry
          enum:
            - docker-registry
          type: string
        username:
          type: string
      required:
        - server
        - username
        - password
      title: Docker Registry
    - properties:
        entries:
          description: Key names and their values.
          items:
            properties:
              key:
                description: Key or file name.
                example: secretstuff.conf
                type: string
              value:
                description: Value to be encrypted.
                example: password=yoursecretpassword
                type: string
            required:
              - key
              - value
          type: array
        type:
          default: generic
          enum:
            - generic
          type: string
      required:
        - entries
      title: Generic
    - properties:
        ca:
          description: The CA certificate content.
          type: string
        crt:
          description: The PEM encoded public key certificate content.
          type: string
        key:
          description: The private key certificate content.
          type: string
        type:
          default: tls
          enum:
            - tls
          type: string
      required:
        - crt
        - key
      title: TLS
  properties:
    id:
      readOnly: true
      type: string
    name:
      $ref: '#/idName'
  required:
    - name
    - type
secrets:
  items:
    additionalProperties: true
    properties:
      entries:
        items:
          properties:
            key:
              type: string
            value:
              type: string
        title: Entries
        type: array
        uniqueItems: true
      name:
        type: string
    required:
      - name
  nullable: true
  title: Secrets
  type: array
subdomainType:
  pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$
  type: string
team:
  additionalProperties: false
  properties:
    alerts:
      $ref: '#/alerts'
    azureMonitor:
      $ref: '#/azureMonitor'
    clusters:
      items:
        type: string
      type: array
    externalSecrets:
      items:
        $ref: '#/externalSecret'
      type: array
    id:
      $ref: '#/idName'
      description: Must be the same as the name.
    jobs:
      $ref: '#/jobs'
    oidc:
      additionalProperties: false
      properties:
        groupMapping:
          description: IDP group id to map onto this team.
          type: string
    password:
      description: Will be used to separate team resources.
      type: string
    secrets:
      $ref: '#/secrets'
    services:
      items:
        additionalProperties: false
        properties:
          authz:
            additionalProperties: false
            description: Identifies a workload to authorize.
            properties:
              forwardOriginalToken:
                default: false
                description: If true istio will forward the bearer token instead of removing it from the headers.
                type: boolean
              workload:
                $ref: '#/labelsAnnotations'
          domain:
            description: A custom service domain name.
            type: string
          forwardPath:
            default: false
            description: Whether to forward the path into the service, or 'terminate' it.
            type: boolean
          id:
            description: Unique identifier created by and used in API. Optional.
            type: string
          internal:
            default: false
            description: If true, service is not going to be exposed to the public domain.
            type: boolean
          isPublic:
            default: false
            description: If true then no SSO will be used.
            type: boolean
          isShared:
            description: When true the service will get it's own domain by prefixing the app name to the cluster domain. Mostly used by core apps.
            type: boolean
          ksvc:
            additionalProperties: false
            description: Details for a knative service that will be deployed and operated.
            properties:
              annotations:
                $ref: '#/annotations'
              autoCD:
                additionalProperties: false
                description: NOT IN USE YET! Deploys new images based on a tagging strategy.
                oneOf:
                  - additionalProperties: false
                    nullable: true
                    title: 'Off'
                  - nullable: true
                    properties:
                      additionalProperties: false
                      semver:
                        description: 'Use this filter if your images tags follow semantic versioning rules (MAJOR.MINOR.PATCH). E.g.: PATCH only: "~1.1", MINOR and PATCH only "~1", ALL "*".'
                        example: 'PATCH only: "~1.1", MINOR and PATCH only "~1", ALL "*",  ">=1.2.3-0"'
                        title: Semver version pattern
                        type: string
                      tagMatcher:
                        default: semver
                        enum:
                          - semver
                        type: string
                    required:
                      - semver
                    title: Semver versioning
                  - additionalProperties: false
                    properties:
                      glob:
                        description: 'Use this filter if you want to make simple non-standard patterns. E.g.: "master-v1.*.*".'
                        example: master-v1.*.*
                        title: Glob string pattern
                        type: string
                      tagMatcher:
                        default: glob
                        enum:
                          - glob
                        type: string
                    required:
                      - glob
                    title: Glob pattern matching
                title: Continuous delivery pipeline
              env:
                $ref: '#/env'
              image:
                $ref: '#/image'
              predeployed:
                default: false
                description: Has this service been predeployed? Otherwise otomi will start it with the configuration given.
                type: boolean
              resources:
                $ref: '#/resources'
              scaleToZero:
                default: false
                description: Scales to zero after 60 seconds and needs approximately 8 seconds to start back up.
                title: Scale to zero
                type: boolean
              secrets:
                $ref: '#/secrets'
          name:
            $ref: '#/idName'
            description: Short name. Will be used for generation of knative service name, as well as service URL.
          ownHost:
            default: true
            description: When true the service will get it's own domain by prefixing the app name to the team domain. Mostly set to true. This will probably be removed soon.
            type: boolean
          paths:
            items:
              description: |
                Path mapping to only let this path go to the service. This allows micro services to operate on the same domain and port.
                When left empty all paths will go to this service.
              type: string
            type: array
          port:
            $ref: '#/portNumber'
            default: 80
            description: Points to the backing k8s service (only used when 'svc' is set).
          svc:
            $ref: '#/idName'
            description: When given a backing k8s service is expected to be deployed with this name, which will be exposed through this team service.
        required:
          - id
          - name
      type: array
  required:
    - id
url:
  pattern: ^(https:\/\/)([\w\-])+\.{1}([a-zA-Z]{2,63})([\/\w-]*)*\/?\??([^#\n\r]*)?#?([^\n\r]*)$
  type: string
volumes:
  items:
    additionalProperties: false
    properties:
      configMap:
        properties:
          name:
            type: string
      name:
        description: Name must match mount name.
        type: string
  type: array
