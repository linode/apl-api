---
annotation:
  pattern: ^((.){1,253}\/)?(.){1,63}$
  type: string
annotations:
  description: Kubernetes annotations with arbitrary metadata
  items:
    properties:
      name:
        $ref: '#/annotation'
      value:
        maxLength: 32767
        type: string
    type: object
  type: array
aws:
  properties:
    provider:
      $ref: '#/provider'
    region:
      title: Region
      type: string
  required:
    - region
  title: AWS DNS Settings
awsCreds:
  properties:
    aws:
      properties:
        accessKey:
          type: string
        region:
          type: string
        secretKey:
          type: string
      required:
        - accessKey
        - secretKey
        - region
    provider:
      $ref: '#/provider'
  title: AWS Credentials
azure:
  description: Enter Azure DNS settings.
  properties:
    aadClientId:
      description: Azure Application Client ID
      title: Client ID
      type: string
    aadClientSecret:
      description: Azure Application Client Secret
      title: Client secret
      type: string
    cloud:
      description: Azure Cloud
      title: Cloud
      type: string
    hostedZoneName:
      title: Hosted zone name
      type: string
    provider:
      $ref: '#/provider'
    resourceGroup:
      description: Azure resource group
      title: Resource group
      type: string
    subscriptionId:
      description: Azure subscription ID
      title: Subscription ID
      type: string
    tenantId:
      description: Azure tenant ID
      title: Tenant ID
      type: string
    useManagedIdentityExtension:
      default: false
      description: If you use Azure MSI, this should be set to true
      title: Using managed identities?
      type: boolean
  required:
    - resourceGroup
    - tenantId
    - subscriptionId
    - aadClientId
    - aadClientSecret
  title: Azure DNS Settings
  type: object
azureCreds:
  description: Enter Azure credentials.
  properties:
    azure:
      properties:
        clientId:
          description: Enter client ID.
          title: Client ID
          type: string
        clientSecret:
          description: Enter client secret.
          title: Client Secret
          type: string
        environment:
          description: Enter Azure environment.
          title: Environment
          type: string
        tenantId:
          description: Enter tenant ID.
          title: Tenant ID
          type: string
      required:
        - clientId
        - clientSecret
        - tenantId
    provider:
      $ref: '#/provider'
  required:
    - azure
    - provider
  title: Azure Credentials
azureMonitor:
  description: Azure Monitor data can be made available in Grafana.
  properties:
    appInsightsApiKey:
      description: An Azure AppInsights client secret.
      title: AppInsights api key
      type: string
    appInsightsAppId:
      description: An Azure AppInsights client id.
      title: AppInsights app id
      type: string
    azureLogAnalyticsSameAs:
      default: true
      title: LogAnalytics using same creds?
      type: boolean
    clientId:
      description: An Azure client id.
      title: Azure client id
      type: string
    clientSecret:
      description: An Azure client secret.
      title: Azure client secret
      type: string
    logAnalyticsClientId:
      description: An Azure client secret.
      title: LogAnalytics client id
      type: string
    logAnalyticsClientSecret:
      description: An Azure client secret.
      title: LogAnalytics client secret
      type: string
    logAnalyticsDefaultWorkspace:
      description: An Azure LogAnalytics workspace.
      title: LogAnalytics workspace
      type: string
    logAnalyticsTenantId:
      description: An Azure tenant id.
      title: LogAnalytics tenant id
      type: string
    subscriptionId:
      description: An Azure subscription id.
      title: Azure subscription id
      type: string
    tenantId:
      description: An Azure monitor log analytics workspace.
      title: LogAnalytics tenant id
      type: string
  required:
    - clientId
    - clientSecret
  title: Azure Monitor
  type: object
cluster:
  properties:
    apiName:
      description: Only used for API/UI to show in app.
      type: string
      readOnly: true
    apiServer:
      description: Used by kubectl for local deployment to target cluster.
      type: string
      readOnly: true
    domainSuffix:
      $ref: 'definitions.yaml#/domain'
      description: Domain suffix for the cluster. Also added to list of dns zones in the Otomi Console.
    entrypoint:
      description: A Kubernetes API public IP address (onprem only).
      type: string
      readOnly: true
    k8sVersion:
      $ref: 'definitions.yaml#/k8sVersion'
      readOnly: true
    name:
      type: string
      readOnly: true
    otomiVersion:
      default: latest
      description: 'Please pin this a valid release version found in the repo. Suggestion: try the most recent stable version.'
      type: string
    provider:
      type: string
      enum:
        - aws
        - azure
        - google
        - onprem
      readOnly: true
    region:
      description: Dependent on provider.
      type: string
      readOnly: true
    vpcID:
      description: AWS only. If provided will override autodiscovery from metadata.
      type: string
      readOnly: true
  required:
    - apiServer
    - domainSuffix
    - k8sVersion
    - name
    - otomiVersion
    - provider
    - region
  type: object

cpuQuantity:
  default: 50m
  description: Amount of cores, or slice of cpu in millis.
  example:
    - '1'
    - 200m
  pattern: ^([0-9]+\.[0-9]{1,2})|([0-9]{2,3}m)?$
  type: string
domain:
  pattern: ^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$
  type: string
email:
  pattern: ^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$
  type: string
env:
  items:
    properties:
      name:
        pattern: ^[a-zA-Z0-9_]*$
        type: string
      value:
        maxLength: 131072
        type: string
    required:
      - name
      - value
    type: object
  nullable: true
  title: Environment variables
  type: array
google:
  description: Enter Google DNS settings.
  properties:
    project:
      description: Enter a GCP project.
      title: GCP Project
      type: string
    provider:
      $ref: '#/provider'
    serviceAccountKey:
      description: Enter a service account key for managing a DNS zone.
      title: Service Account Key
      type: string
  required:
    - serviceAccountKey
    - project
    - provider
  title: Google DNS Settings
  type: object
googleCreds:
  description: Enter Google credentials.
  properties:
    google:
      description: Enter GCP details.
      properties:
        accountJson:
          description: Enter GCP account JSON for authentication.
          title: Account JSON
          type: string
        project:
          description: Enter GCP project.
          title: GCP Project
          type: string
      title: Google
    provider:
      $ref: '#/provider'
  required:
    - google
    - provider
  title: Google Credentials
hostPort:
  pattern: ^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9]):()([1-9]|[1-5]?[0-9]{2,4}|6[1-4][0-9]{3}|65[1-4][0-9]{2}|655[1-2][0-9]|6553[1-5])$
  type: string
idName:
  description: A lowercase name that starts with a letter and may contain dashes.
  pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
  type: string
image:
  additionalProperties: false
  properties:
    pullPolicy:
      default: IfNotPresent
      enum:
        - IfNotPresent
        - Always
      type: string
    repository:
      $ref: '#/repository'
    tag:
      default: latest
      type: string
  title: Container image
  type: object
imageSimple:
  additionalProperties: false
  properties:
    pullPolicy:
      default: IfNotPresent
      enum:
        - IfNotPresent
        - Always
      type: string
    tag:
      type: string
  title: Container image
  type: object
k8sVersion:
  default: '1.19'
  description: The cluster k8s version. Otomi supports 2 minor versions backwards compatibility from the suggested default.
  enum:
    - '1.17'
    - '1.18'
    - '1.19'
  type: string
labels:
  $ref: '#/annotations'
  description: A set of labels.
labelsAnnotations:
  additionalProperties: false
  items:
    properties:
      name:
        pattern: ^((([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9]){1,253}\/)?([a-z0-9A-Z]+[a-z0-9A-Z-_.]+[a-z0-9A-Z]){1,63}$
        type: string
      values:
        pattern: ^((.){1,253}\/)?(.){1,63}$
        type: string
    type: object
  type: array
logLevel:
  default: info
  enum:
    - error
    - warn
    - info
    - debug
    - trace
  type: string
memoryQuantity:
  default: 64Mi
  description: Amount of memory. Valid units are E|P|T|G|M|K|Ei|Pi|Ti|Gi|Mi|Ki.
  example:
    - 1Mi
    - 0.5M
  pattern: ^([0-9]+\.)?[0-9]+(E|P|T|G|M|K|Ei|Pi|Ti|Gi|Mi|Ki)?$
  type: string
podSecurityContext:
  properties:
    runAsGroup:
      default: 1001
      maximum": 65535
      minimum": 0
      type: integer
    runAsNonRoot:
      default: true
      type: boolean
    runAsUser:
      default: 1001
      maximum": 65535
      minimum": 0
      type: integer
  type: object
portNumber:
  default: 80
  maximum: 32768
  minimum: 80
  type: number
provider:
  description: This property is reserved for the Discriminator object in validation.
  title: Provider Discriminator Property
  type: string
rawValues:
  description: "May define value overrides for a chart. WARNING: these values currently have no schema and can't be validated as such, and may break deployment. You are on your own here."
  type: object
registry:
  pattern: ^[a-z0-9]+(?:[._-][a-z0-9]+)*$
  type: string
repoUrl:
  description: Path to a remote git repo without protocol. Will use https to access.
  pattern: ^(.+@)*([\w\d\.]+)(:[\d]+){0,1}/*(.*)$
  type: string
repository:
  description: A container image repository.
  pattern: ^[a-z0-9]+(?:[/._-]{1,2}[a-z0-9]+)*$
  type: string
resource:
  additionalProperties: false
  properties:
    cpu:
      $ref: '#/cpuQuantity'
    memory:
      $ref: '#/memoryQuantity'
  required:
    - cpu
    - memory
  type: object
resources:
  additionalProperties: false
  description: Compute resources for containers.
  properties:
    limits:
      $ref: '#/resource'
      description: Requested resources (best effort).
    requests:
      $ref: '#/resource'
      description: Requested resources (guaranteed).
  title: Pod resources
  type: object
scaling:
  description: Min and max number of replicas.
  properties:
    maxReplicas:
      type: number
    minReplicas:
      type: number
  type: object
script:
  description: May specify a non-empty string containing an executable script.
  type: string
secret:
  oneOf:
    - properties:
        entries:
          items:
            description: A property name at vaultPath
            minItems: 1
            pattern: ^[a-zA-Z0-9_]*$
            type: string
            uniqueItems: true
          type: array
        type:
          default: generic
          enum:
            - generic
      required:
        - type
        - entries
      title: Generic
    - properties:
        dockerconfig:
          enum:
            - .dockerconfig.json
          readOnly: true
          type: string
        type:
          default: docker-registry
          enum:
            - docker-registry
          type: string
      required:
        - type
      title: Docker registry
    - properties:
        ca:
          default: ca.crt
          type: string
        crt:
          default: tls.crt
          type: string
        key:
          default: tls.key
          type: string
        type:
          default: tls
          enum:
            - tls
          type: string
      required:
        - type
        - crt
        - key
      title: TLS
  properties:
    id:
      readOnly: true
      type: string
    name:
      $ref: '#/subdomainType'
  required:
    - name
  type: object
secrets:
  description: A list of team secrets that will be mounted into the pod as env vars.
  items:
    type: string
  title: Secrets
  type: array
  uniqueItems: true
settingsType:
  description: This property is reserved for the Discriminator object in validation.
  title: Settings Type
  type: string
subdomainType:
  pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$
  type: string
url:
  pattern: ^(https:\/\/)([\w\-])+\.{1}([a-zA-Z]{2,63})([\/\w-]*)*\/?\??([^#\n\r]*)?#?([^\n\r]*)$
  type: string
vaultCreds:
  description: Enter Hashicorp's Vault credentials.
  properties:
    provider:
      $ref: '#/provider'
    vault:
      properties:
        token:
          type: string
      required:
        - token
  required:
    - provider
    - vault
  title: Vault Credentials
volumes:
  items:
    additionalProperties: false
    properties:
      configMap:
        properties:
          name:
            type: string
        type: object
      name:
        description: Name must match mount name.
        type: string
    type: object
  type: array
