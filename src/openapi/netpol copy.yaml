Netpol:
  x-acl:
    admin:
      - delete-any
      - read-any
      - create-any
      - update-any
    team:
      - delete
      - read
      - create
      - update
  type: object
  description: Create network policies for ingress and egress
  additionalProperties: false
  x-externalDocsPath: docs/for-devs/console/networkpolicies
  properties:
    id:
      type: string
    teamId:
      $ref: definitions.yaml#/idName
    name:
      $ref: 'definitions.yaml#/wordCharacterPattern'
    ruleType:
      $ref: '#/ruleType'
  required:
    - name

ruleType:
  title: Rule type
  description: Choose between Ingress or Egress
  type: object
  oneOf:
    - title: Ingress
      type: object
      description: 'Control traffic between Services and Teams'
      properties:
        ingressPrivate:
          additionalProperties: false
          type: object
          properties:
            toLabelName:
              type: string
              title: Selector label name
              description: 'The name of the Pod selector label'
            toLabelValue:
              type: string
              title: Selector label value
              description: 'The value of the Pod selector label'
            oneOf:
              - title: Allow all
                type: object
                description: Allow traffic from all teams
                properties:
                  mode:
                    type: string
                    default: AllowAll
                    enum:
                      - AllowAll
                required: [mode]
              - title: Allow selected
                type: object
                properties:
                  mode:
                    type: string
                    default: AllowOnly
                    enum:
                      - AllowOnly
                  allow:
                    title: Allow entire team or just a workload
                    type: array
                    minItems: 1
                    items:
                      type: object
                      properties:
                        fromLabelName:
                          type: string
                          title: Selector label name
                          description: 'The name of the Pod selector label'
                        fromLabelValue:
                          type: string
                          title: Selector label value
                          description: 'The value of the Pod selector label'
                        fromNamespace:
                          type: string
                          title: Namespace name
                          description: 'The name of the namespace'
                      required:
                        - fromNamespace
                required:
                  - mode
                  - allow
    - title: External egress filtering
      description: Trusted domains this service can access
      type: object
      properties:
        egressPublic:
          type: array
          items:
            type: object
            properties:
              domain:
                title: FQDN or IP address
                $ref: definitions.yaml#/domain
              ports:
                type: objects
                properties:
                  number:
                    title: Port number
                    type: integer
                    minimum: 1
                    maximum: 65535
                  protocol:
                    title: Protocol
                    type: string
                    enum: [HTTPS, HTTP, TCP]
                    default: HTTPS
                required:
                  - number
                  - protocol
              default:
                - number: 443
                  protocol: HTTPS
            required:
              - domain