SealedSecret:
  x-acl:
    platformAdmin:
      - create-any
      - read-any
      - update-any
      - delete-any
    teamAdmin:
      - create
      - read
      - update
      - delete
    teamMember:
      - create
      - read
      - update
      - delete
  properties:
    name:
      title: Name
      $ref: 'definitions.yaml#/idName'
    namespace:
      $ref: 'definitions.yaml#/idName'
    encryptedData:
      type: object
      additionalProperties:
        type: string
    template:
      $ref: '#/SealedSecretTemplate'
  required:
    - name
    - type
    - encryptedData
  type: object

# Secret type enum - reusable
SecretType:
  type: string
  default: kubernetes.io/opaque
  enum:
    - kubernetes.io/opaque
    - kubernetes.io/dockercfg
    - kubernetes.io/dockerconfigjson
    - kubernetes.io/basic-auth
    - kubernetes.io/ssh-auth
    - kubernetes.io/tls

# Template metadata schema for K8s SealedSecret
SealedSecretTemplateMetadata:
  type: object
  properties:
    name:
      $ref: 'definitions.yaml#/idName'
    namespace:
      $ref: 'definitions.yaml#/idName'
    annotations:
      type: object
      additionalProperties:
        type: string
    labels:
      type: object
      additionalProperties:
        type: string
    finalizers:
      type: array
      items:
        type: string

# Template schema for K8s SealedSecret
SealedSecretTemplate:
  type: object
  properties:
    type:
      $ref: '#/SecretType'
    immutable:
      description: 'Immutable, if set to true, ensures that data stored in the Secret cannot be updated (only object metadata can be modified).'
      type: boolean
      default: false
    metadata:
      $ref: '#/SealedSecretTemplateMetadata'

# The raw Kubernetes SealedSecret spec (nested inside APL spec)
SealedSecretManifestSpec:
  type: object
  properties:
    encryptedData:
      type: object
      additionalProperties:
        type: string
    template:
      $ref: '#/SealedSecretTemplate'
  required:
    - encryptedData
