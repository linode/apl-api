idName: &idNameField
  type: string
  pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$

Service:
  x-acl:
    admin:
      - delete-any
      - read-any
      - create-any
      - update-any
    team:
      - delete
      - read
      - create
      - update
  x-externalDocsPath: docs/configuring-services
  properties:
    enabled:
      default: true
      type: boolean
    id:
      readOnly: true
      type: string
    name:
      <<: *idNameField
      title: Name
      description: A service name
      example: some-service
    port:
      description: A service port
      type: integer
      default: 80
      minimum: 1
      maximum: 65535
    ksvc:
      oneOf:
        - properties:
            annotations:
              $ref: definitions.yaml#/annotations
              title: Pod annotations
            autoCD:
              description: Deploys new images based on a tagging strategy
              oneOf:
                - additionalProperties: false
                  nullable: true
                  title: 'Off'
                  type: object
                - nullable: true
                  properties:
                    semver:
                      description: 'Use this filter if your image tags follow semantic versioning rules (MAJOR.MINOR.PATCH). E.g.: PATCH only: "~1.1", MINOR and PATCH only "~1", ALL "*"'
                      example: 'PATCH only: "~1.1", MINOR and PATCH only "~1", ALL "*",  ">=1.2.3-0"'
                      title: Semver version pattern
                      type: string
                    tagMatcher:
                      default: semver
                      enum:
                        - semver
                      type: string
                  required:
                    - semver
                  title: Semver versioning
                  type: object
                - additionalProperties: false
                  properties:
                    glob:
                      description: 'Use this filter if you want to make glob-style patterns. E.g.: "main-v1.3.*"'
                      example: main-v1.3.*
                      title: Glob string pattern
                      type: string
                    tagMatcher:
                      default: glob
                      enum:
                        - glob
                      type: string
                  required:
                    - glob
                  title: Glob pattern matching
                  type: object
              title: Continuous delivery
            env:
              $ref: definitions.yaml#/env
            image:
              properties:
                repository:
                  $ref: definitions.yaml#/repository
                tag:
                  pattern: '[\w][\w.-]{0,127}'
                  type: string
              required:
                - repository
                - tag
              title: Container image
              type: object
            resources:
              $ref: definitions.yaml#/resources
            scaleToZero:
              default: false
              description: Scales to zero after 60 seconds and needs approximately 8 seconds to start back up.
              title: Scale to zero
              type: boolean
            secrets:
              $ref: definitions.yaml#/secrets
            serviceType:
              default: ksvc
              enum:
                - ksvc
              type: string
          required:
            - serviceType
          title: Knative service
        - properties:
            serviceType:
              default: ksvcPredeployed
              enum:
                - ksvcPredeployed
              type: string
          required:
            - serviceType
          title: Existing Knative service
          type: object
        - properties:
            serviceType:
              default: svcPredeployed
              enum:
                - svcPredeployed
              type: string
          required:
            - serviceType
          title: Existing Kubernetes service
          type: object
      title: Type
      type: object
    ingress:
      oneOf:
        - additionalProperties: false
          nullable: true
          title: Private
          type: object
        - properties:
            useDefaultSubdomain:
              default: true
              description: Use the team domain so that the URL reveals the owner.
              title: Use team domain (preferred)
              type: boolean
            subdomain:
              $ref: definitions.yaml#/domain
              description: A host that is used to set DNS 'A' records
              nullable: true
              title: Host
              type: string
            domain:
              description: A managed DNS zone
              title: DNS Zone
              type: string
            path:
              description: The path in the URL that the service should be mapped to (e.g. for microservices on one app/domain.)
              title: URL path
              type: string
            forwardPath:
              description: Forward the URL path into the service (don't rewrite to /)
              title: Forward path
              type: boolean
            hasSingleSignOn:
              default: false
              title: Authenticate with Single Sign On
              type: boolean
            hasCert:
              default: false
              description: If true a certificate should exist already
              title: Already has a certificate
              type: boolean
            certArn:
              example: arn:aws:acm:eu-central-1:xxx:certificate/xxx
              title: Certificate ARN
              type: string
            certSelect:
              default: true
              title: Select existing secret name
              type: boolean
            certName:
              example: www-example-com
              title: Secret name
              type: string
          required:
            - domain
            - subdomain
          title: Public URL
          type: object
      title: Exposure
      x-acl:
        team:
          - read
    teamId:
      <<: *idNameField
      readOnly: true
  required:
    - name
  type: object
