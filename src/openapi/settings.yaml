Settings:
  x-acl:
    admin: [read-any, update-any]
    team: [read]
  additionalProperties: false
  properties:
    alerts:
      additionalProperties: false
      $ref: definitions.yaml#/alerts
      title: Alerts
      description: Configure alerting endpoints to receive notifications from Alertmanager.
      x-externalDocsPath: docs/for-ops/console/settings#alerts
    cluster:
      additionalProperties: false
      $ref: cluster.yaml#/Cluster
      title: Cluster
      description: Cluster configuration.
    platformBackups:
      additionalProperties: false
      type: object
      properties:
        database:
          type: object
          title: Database backups
          properties:
            harbor:
              title: Harbor
              properties:
                enabled:
                  type: boolean
                  default: false
                retentionPolicy:
                  $ref: definitions.yaml#/backupRetentionPolicy
                schedule:
                  $ref: definitions.yaml#/backupSchedule
            gitea:
              title: Gitea
              properties:
                enabled:
                  type: boolean
                  default: false
                retentionPolicy:
                  $ref: definitions.yaml#/backupRetentionPolicy
                schedule:
                  $ref: definitions.yaml#/backupSchedule
            keycloak:
              title: Keycloak
              properties:
                enabled:
                  type: boolean
                  default: false
                retentionPolicy:
                  $ref: definitions.yaml#/backupRetentionPolicy
                schedule:
                  $ref: definitions.yaml#/backupSchedule
        persistentVolumes:
          title:  Backup Persistent Volumes
          description: To create backups of PVs, add a Linode API token and enable the Velero App.
          properties:
            linodeApiToken:
              type: string
              $ref: definitions.yaml#/wordCharacterPattern
              x-secret: true
    obj:
      type: object
      properties:
        provider:
          type: object
          title: Object Storage provider
          description: Select the preferred Object Storage provider.
          oneOf:
            - title: Disabled
              type: object
              properties:
                type:
                  type: string
                  enum:
                    - disabled
                  default: disabled
            - title: minioLocal
              type: object
              x-hideTitle: true
              description: Select to use the self-hosted Minio instance. Make sure to activate Minio first.
              properties:
                type:
                  type: string
                  enum:
                    - minioLocal
                  default: minioLocal
            - title: Linode
              type: object
              x-hideTitle: true
              properties:
                linode:
                  type: object
                  title: Linode
                  description: Select to use Linode Object Storage.
                  properties:
                    region:
                      type: string
                      description: The name of the Linode region.
                      $ref: definitions.yaml#/wordCharacterPattern
                    accessKeyId:
                      type: string
                      description: The ID of the access key.
                      $ref: definitions.yaml#/wordCharacterPattern
                    secretAccessKey:
                      type: string
                      description: The secret of the access key.
                      $ref: definitions.yaml#/wordCharacterPattern
                      x-secret: true
                    buckets:
                      description: Add the preferred bucket names for each app.
                      properties:
                        loki:
                          type: string
                          $ref: definitions.yaml#/wordCharacterPattern
                          default: loki
                        cnpg:
                          type: string
                          $ref: definitions.yaml#/wordCharacterPattern
                          default: cnpg
                        velero:
                          type: string
                          $ref: definitions.yaml#/wordCharacterPattern
                          default: velero
                        harbor:
                          type: string
                          $ref: definitions.yaml#/wordCharacterPattern
                          default: harbor
                        tempo:
                          type: string
                          $ref: definitions.yaml#/wordCharacterPattern
                          default: tempo 
                  required:
                    - region
                    - accessKeyId
                    - secretAccessKey
                type:
                  type: string
                  enum:
                    - linode
                  default: linode
              required:
                - linode
                - type
    dns:
      $ref: definitions.yaml#/dns
      x-externalDocsPath: docs/for-ops/console/settings/dns
      x-acl:
        admin: [read-any, update-any]
        team: []
    ingress:
      type: object
      properties:
        platformClass:
          allOf:
            - type: object
              properties:
                className:
                  title: Class name
                  description: The platform ingress class is assigned to all platform applications
                  type: string
                  default: platform
                  # readOnly: true
            - $ref: definitions.yaml#/ingressClassParameters
        classes:
          title: Additional classes
          type: array
          items:
            allOf:
              - type: object
                properties:
                  className:
                    description: An arbitrary name that will be used to assign an ingress class to a team service
                    type: string
              - $ref: definitions.yaml#/ingressClassParameters
            required:
              - className
    kms:
      $ref: definitions.yaml#/kms
      x-externalDocsPath: docs/for-ops/console/settings/key-management
      x-acl:
        admin: [read-any, update-any]
        team: []
    oidc:
      title: OIDC
      description: OpenID Connect settings.
      additionalProperties: false
      properties:
        issuer:
          type: string
          $ref: definitions.yaml#/url
        clientID:
          title: Client ID
          type: string
        clientSecret:
          title: Client Secret
          type: string
          x-secret: true
        adminGroupID:
          title: Admin group ID
          type: string
        teamAdminGroupID:
          title: Team admin group ID
          type: string
        usernameClaimMapper:
          description: Claim name used by Keycloak to identify incoming users from the identity provider.
          default: '${CLAIM.upn}'
          type: string
        subClaimMapper:
          type: string
          description: Select OIDC claim to be passed by Keycloak as a unique user identifier. Best to not change this from the default.
          default: sub
      type: object
      x-externalDocsPath: docs/for-ops/console/settings/oidc
      x-acl:
        admin: [read-any, update-any]
        team: []
      required:
        - issuer
        - clientID
        - clientSecret
    otomi:
      title: APL
      type: object
      description: Settings for APL.
      additionalProperties: false
      properties:
        adminPassword:
          description: Master admin password that will be used for all apps that are not configured to use their own password.
          $ref: definitions.yaml#/adminPassword
          x-acl:
            admin: [read-any]
            team: []
          # readOnly: true
        additionalClusters:
          title: Additional clusters
          description: Enter other clusters running APL.
          type: array
          items:
            $ref: cluster.yaml#/AdditionalCluster
            required:
              - domainSuffix
              - name
              - provider
          x-acl:
            admin: [read-any, update-any]
            team: []
        globalPullSecret:
          nullable: true
          title: Global pullsecret
          description:
            Will be connected to each "default" service account in all APL app namespaces.
            Handy for authenticating with DockerHub to avoid rate limiting.
            Also useful when pulling all APL images from a private repo. (One would need to override all the images in the config first.)
          additionalProperties: false
          properties:
            username:
              type: string
              x-acl:
                admin: [read-any, update-any]
                team: []
            password:
              type: string
              x-secret: true
              x-acl:
                admin: [read-any, update-any]
                team: []
            email:
              type: string
              x-acl:
                admin: [read-any, update-any]
                team: []
              x-default: not@us.ed
            server:
              type: string
              x-default: docker.io
          # disabling required fields until rjsf solves this nested required bug:
          # required:
          #   - username
          #   - password
          type: object
          x-acl:
            admin: [read-any, update-any]
            team: []
        hasExternalDNS:
          description: Set this to true when an external dns zone is available to manage dns records. (Expects required `dns:` fields to be set.)
          title: External DNS
          type: boolean
          default: false
        hasExternalIDP:
          description: Set this to true when bringing your own external IDP such as Azure AD. (Expects required `oidc:` fields to be set.)
          title: External IDP
          type: boolean
          default: false
        isMultitenant:
          description: Will separate team metrics and logs. Disabling this effectively gives all users admin role and lets them see everything.
          title: Multi-tenancy
          type: boolean
          default: true
        nodeSelector:
          $ref: definitions.yaml#/labels
          description: 'One or more "label: value" pairs that must exist on one or more nodes, which will force all APL services to be scheduled there.'
        version:
          title: APL version
          default: latest
          description: |
            Please pin this to a valid release version found in the repo.
          type: string
      required:
        - version
      x-externalDocsPath: docs/for-ops/console/settings/otomi
      x-acl:
        admin: [read-any, update-any]
        team: [read]
    smtp:
      title: SMTP
      description: Mail server settings.
      additionalProperties: false
      nullable: true
      properties:
        auth_identity:
          title: Authentication identity
          type: string
        auth_password:
          title: Authentication password
          type: string
        auth_secret:
          title: Authentication secret
          type: string
        auth_username:
          title: Authentication username
          type: string
        from:
          $ref: definitions.yaml#/email
          description: The "from" address. Defaults to alerts@$clusterDomain.
          title: From address
        hello:
          description: The hostname to identify to the SMTP server.
          title: Hello
          type: string
        smarthost:
          description: The smtp host:port combination.
          pattern: ^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9]):()([1-9]|[1-5]?[0-9]{2,4}|6[1-4][0-9]{3}|65[1-4][0-9]{2}|655[1-2][0-9]|6553[1-5])$
          type: string
          title: Smart Host
      required:
        - smarthost
      type: object
      x-externalDocsPath: docs/for-ops/console/settings/smtp
      x-acl:
        admin: [read-any, update-any]
        team: []
  type: object
