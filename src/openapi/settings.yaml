Settings:
  x-acl:
    admin: [read-any, update-any]
    team: [read]
  additionalProperties: false
  properties:
    alerts:
      additionalProperties: false
      $ref: definitions.yaml#/alerts
      title: Alerts
      description: Configure alerting endpoints to receive notifications from Alertmanager and Otomi deployments.
      x-externalDocsPath: docs/for-ops/console/settings#alerts
    cluster:
      additionalProperties: false
      $ref: cluster.yaml#/Cluster
      title: Cluster
      description: Cluster configuration.
    platformBackups:
      additionalProperties: false
      type: object
      properties:
        database:
          type: object
          title: Database backups
          properties:
            harbor:
              title: Harbor
              properties:
                enabled:
                  type: boolean
                  default: false
                retentionPolicy:
                  $ref: definitions.yaml#/backupRetentionPolicy
                schedule:
                  $ref: definitions.yaml#/backupSchedule
        persistentVolumes:
          x-externalDocsPath: docs/for-ops/console/settings/backup
          title: PersistentVolumes backups
          description: Platform app Persistent Volume backup schedules.
          type: object
          properties:
            gitea:
              title: Gitea
              properties:
                enabled:
                  type: boolean
                ttl:
                  $ref: definitions.yaml#/backupTtl
                schedule:
                  $ref: definitions.yaml#/backupSchedule
            drone:
              title: Drone
              properties:
                enabled:
                  type: boolean
                ttl:
                  $ref: definitions.yaml#/backupTtl
                schedule:
                  $ref: definitions.yaml#/backupSchedule
            keycloak:
              title: Keycloak
              properties:
                enabled:
                  type: boolean
                ttl:
                  $ref: definitions.yaml#/backupTtl
                schedule:
                  $ref: definitions.yaml#/backupSchedule
            harbor:
              title: Harbor
              properties:
                enabled:
                  type: boolean
                ttl:
                  $ref: definitions.yaml#/backupTtl
                schedule:
                  $ref: definitions.yaml#/backupSchedule
            vault:
              title: Vault
              properties:
                enabled:
                  type: boolean
                ttl:
                  $ref: definitions.yaml#/backupTtl
                schedule:
                  $ref: definitions.yaml#/backupSchedule
            argo:
              title: ArgoCD
              properties:
                enabled:
                  type: boolean
                ttl:
                  $ref: definitions.yaml#/backupTtl
                schedule:
                  $ref: definitions.yaml#/backupSchedule
            minio:
              title: Minio
              properties:
                enabled:
                  type: boolean
                ttl:
                  $ref: definitions.yaml#/backupTtl
                schedule:
                  $ref: definitions.yaml#/backupSchedule
    home:
      additionalProperties: false
      $ref: definitions.yaml#/alerts
      title: Co-monitoring
      description: Send alerts to a 3rd party for co-monitoring
      x-externalDocsPath: docs/for-ops/console/settings#co-monitoring
      x-acl:
        admin: [read-any, update-any]
        team: []
    azure:
      title: Azure
      additionalProperties: false
      description: Azure specific configuration. Only applicable on Azure clusters.
      x-externalDocsPath: docs/for-ops/console/settings/azure
      x-acl:
        admin: [read-any, update-any]
        team: []
      properties:
        appgw:
          title: Azure Application Gateway Ingress Controller
          properties:
            isManaged:
              title: Managed by AKS
              description: Indicates Azure Application Gateway Ingress Controller add-on is installed by AKS.
              type: boolean
              default: false
          type: object
        storageType:
          title: Storage types
          description: Disk types used for storage classes in Otomi.
          properties:
            fast:
              type: string
              default: StandardSSD_LRS
            standard:
              type: string
              default: StandardLRS
          type: object
      required:
        - resourceGroup
        - subscriptionId
        - tenantId
      type: object
    dns:
      $ref: definitions.yaml#/dns
      x-externalDocsPath: docs/for-ops/console/settings/dns
      x-acl:
        admin: [read-any, update-any]
        team: []
    ingress:
      type: object
      properties:
        platformClass:
          allOf:
            - type: object
              properties:
                className:
                  title: Class name
                  description: The platform ingress class is assigned to all platform applications
                  type: string
                  default: platform
                  # readOnly: true
            - $ref: definitions.yaml#/ingressClassParameters
        classes:
          title: Additional classes
          type: array
          items:
            allOf:
              - type: object
                properties:
                  className:
                    description: An arbitrary name that will be used to assign an ingress class to a team service
                    type: string
              - $ref: definitions.yaml#/ingressClassParameters
            required:
              - className
    kms:
      $ref: definitions.yaml#/kms
      x-externalDocsPath: docs/for-ops/console/settings/key-management
      x-acl:
        admin: [read-any, update-any]
        team: []
    oidc:
      title: OIDC
      description: OpenID Connect settings.
      additionalProperties: false
      properties:
        issuer:
          type: string
          $ref: definitions.yaml#/url
        clientID:
          title: Client ID
          type: string
        clientSecret:
          title: Client Secret
          type: string
          x-secret: true
        adminGroupID:
          title: Admin group ID
          type: string
        teamAdminGroupID:
          title: Team admin group ID
          type: string
        usernameClaimMapper:
          description: Claim name used by Keycloak to identify incoming users from the identity provider.
          default: '${CLAIM.upn}'
          type: string
        subClaimMapper:
          type: string
          description: Select OIDC claim to be passed by Keycloak as a unique user identifier. Best to not change this from the default.
          default: sub
      type: object
      x-externalDocsPath: docs/for-ops/console/settings/oidc
      x-acl:
        admin: [read-any, update-any]
        team: []
      required:
        - issuer
        - clientID
        - clientSecret
    otomi:
      title: Otomi
      type: object
      description: Settings for Otomi.
      additionalProperties: false
      properties:
        adminPassword:
          description: Master admin password that will be used for all apps that are not configured to use their own password.
          $ref: definitions.yaml#/adminPassword
          x-acl:
            admin: [read-any]
            team: []
          # readOnly: true
        additionalClusters:
          title: Additional clusters
          description: Enter other clusters running Otomi.
          type: array
          items:
            $ref: cluster.yaml#/AdditionalCluster
            required:
              - domainSuffix
              - name
              - provider
          x-acl:
            admin: [read-any, update-any]
            team: []
        globalPullSecret:
          nullable: true
          title: Global pullsecret
          description:
            Will be connected to each "default" service account in all otomi app namespaces.
            Handy for authenticating with DockerHub to avoid rate limiting.
            Also useful when pulling all otomi images from a private repo. (One would need to override all the images in the config first.)
          additionalProperties: false
          properties:
            username:
              type: string
              x-acl:
                admin: [read-any, update-any]
                team: []
            password:
              type: string
              x-secret: true
              x-acl:
                admin: [read-any, update-any]
                team: []
            email:
              type: string
              x-acl:
                admin: [read-any, update-any]
                team: []
              x-default: not@us.ed
            server:
              type: string
              x-default: docker.io
          # disabling required fields until rjsf solves this nested required bug:
          # required:
          #   - username
          #   - password
          type: object
          x-acl:
            admin: [read-any, update-any]
            team: []
        hasExternalDNS:
          description: Set this to true when an external dns zone is available to manage dns records. (Expects required `dns:` fields to be set.)
          title: External DNS
          type: boolean
          default: false
        hasExternalIDP:
          description: Set this to true when bringing your own external IDP such as Azure AD. (Expects required `oidc:` fields to be set.)
          title: External IDP
          type: boolean
          default: false
        isHomeMonitored:
          description: Whether this cluster is monitored by a third party.
          title: Co-monitoring
          type: boolean
          default: false
        isMultitenant:
          description: Will separate team metrics and logs. Disabling this effectively gives all users admin role and lets them see everything.
          title: Multi-tenancy
          type: boolean
          default: true
        nodeSelector:
          $ref: definitions.yaml#/labels
          description: 'One or more "label: value" pairs that must exist on one or more nodes, which will force all otomi platform workloads to be scheduled there.'
        version:
          title: Otomi version
          default: latest
          description: |
            Please pin this to a valid release version found in the repo. Suggestion: try the most recent stable version.
          type: string
      required:
        - version
      x-externalDocsPath: docs/for-ops/console/settings/otomi
      x-acl:
        admin: [read-any, update-any]
        team: [read]
    policies:
      $ref: policies.yaml#/policies
      x-acl:
        admin: [read-any, update-any]
        team: []
    smtp:
      title: SMTP
      description: Mail server settings.
      additionalProperties: false
      nullable: true
      properties:
        auth_identity:
          title: Authentication identity
          type: string
        auth_password:
          title: Authentication password
          type: string
        auth_secret:
          title: Authentication secret
          type: string
        auth_username:
          title: Authentication username
          type: string
        from:
          $ref: definitions.yaml#/email
          description: The "from" address. Defaults to alerts@$clusterDomain.
          title: From address
        hello:
          description: The hostname to identify to the SMTP server.
          title: Hello
          type: string
        smarthost:
          description: The smtp host:port combination.
          pattern: ^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9]):()([1-9]|[1-5]?[0-9]{2,4}|6[1-4][0-9]{3}|65[1-4][0-9]{2}|655[1-2][0-9]|6553[1-5])$
          type: string
          title: Smart Host
      required:
        - smarthost
      type: object
      x-externalDocsPath: docs/for-ops/console/settings/smtp
      x-acl:
        admin: [read-any, update-any]
        team: []
  type: object
