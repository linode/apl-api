TeamSelfService:
  title: Team permissions
  description: Grant team permissions to modify certain configuration parameters.
  type: object
  properties:
    service:
      title: Service
      type: array
      items:
        type: string
        enum: [ingress]
      x-allow-values:
        ingress:
          type: 'cluster'
      default: [ingress]
      uniqueItems: true
    policies:
      title: Security policies
      type: array
      items:
        type: string
        enum: ['edit policies']
      default: ['edit policies']
      uniqueItems: true
    team:
      title: Team settings
      type: array
      items:
        type: string
        # downloadKubeConfig - is an action that a user can perform, not an attribute of the input form
        enum:
          [
            oidc,
            managedMonitoring,
            alerts,
            resourceQuota,
            networkPolicy,
          ]
      uniqueItems: true
    apps:
      title: Apps
      type: array
      items:
        type: string
        enum: [argocd, gitea]
      default: []
      uniqueItems: true
    access:
      title: Access
      type: array
      items:
        type: string
        enum:
          [
            shell,
            downloadKubeConfig,
            downloadDockerConfig,
            downloadCertificateAuthority,
          ]
      uniqueItems: true
  x-acl:
    admin: [read-any, update-any]
    team: [read]

Team:
  properties:
    id:
      $ref: definitions.yaml#/idName
      title: ID
    name:
      $ref: definitions.yaml#/idName
      title: Name
      description: A team name
    oidc:
      properties:
        groupMapping:
          description: An OIDC group (name/id) granting access to this Team.
          title: Group mapping
          type: string
      title: OIDC
      type: object
    password:
      type: string
      writeOnly: true
      x-acl:
        admin: [ read-any, update-any ]
        team: [ ]
    managedMonitoring:
      title: Managed monitoring
      description: "Activate APL managed Grafana or Alertmanager instances. Optionally disable cross-team access."
      properties:
        grafana:
          type: boolean
          default: false
        alertmanager:
          type: boolean
          default: false
        private:
          type: boolean
          default: false
    resources:
      type: object
      properties:
        alertmanager:
          type: object
          properties:
            requests:
              type: object
              properties:
                cpu:
                  $ref: definitions.yaml#/quantityCpu
                  default: 10m
                memory:
                  $ref: definitions.yaml#/quantityMem
                  default: 64Mi
            limits:
              type: object
              properties:
                cpu:
                  $ref: definitions.yaml#/quantityCpu
                  default: 200m
                memory:
                  $ref: definitions.yaml#/quantityMem
                  default: 256Mi
          required:
            - limits
            - requests
        grafana:
          type: object
          properties:
            requests:
              type: object
              properties:
                cpu:
                  $ref: definitions.yaml#/quantityCpu
                  default: 10m
                memory:
                  $ref: definitions.yaml#/quantityMem
                  default: 128Mi
            limits:
              type: object
              properties:
                cpu:
                  $ref: definitions.yaml#/quantityCpu
                  default: '1'
                memory:
                  $ref: definitions.yaml#/quantityMem
                  default: 1Gi
          required:
            - limits
            - requests
        grafanaSidecar:
          type: object
          properties:
            requests:
              type: object
              properties:
                cpu:
                  $ref: definitions.yaml#/quantityCpu
                  default: 10m
                memory:
                  $ref: definitions.yaml#/quantityMem
                  default: 128Mi
            limits:
              type: object
              properties:
                cpu:
                  $ref: definitions.yaml#/quantityCpu
                  default: 200m
                memory:
                  $ref: definitions.yaml#/quantityMem
                  default: 256Mi
          required:
            - limits
            - requests
        buildpacksTask:
          type: object
          properties:
            requests:
              type: object
              properties:
                cpu:
                  $ref: definitions.yaml#/quantityCpu
                  default: 200m
                memory:
                  $ref: definitions.yaml#/quantityMem
                  default: 128Mi
            limits:
              type: object
              properties:
                cpu:
                  $ref: definitions.yaml#/quantityCpu
                  default: '2'
                memory:
                  $ref: definitions.yaml#/quantityMem
                  default: 2Gi
          required:
            - limits
            - requests
        gitcloneTask:
          type: object
          properties:
            requests:
              type: object
              properties:
                cpu:
                  $ref: definitions.yaml#/quantityCpu
                  default: 200m
                memory:
                  $ref: definitions.yaml#/quantityMem
                  default: 128Mi
            limits:
              type: object
              properties:
                cpu:
                  $ref: definitions.yaml#/quantityCpu
                  default: '2'
                memory:
                  $ref: definitions.yaml#/quantityMem
                  default: 2Gi
          required:
            - limits
            - requests
        grypeTask:
          type: object
          properties:
            requests:
              type: object
              properties:
                cpu:
                  $ref: definitions.yaml#/quantityCpu
                  default: 200m
                memory:
                  $ref: definitions.yaml#/quantityMem
                  default: 128Mi
            limits:
              type: object
              properties:
                cpu:
                  $ref: definitions.yaml#/quantityCpu
                  default: '2'
                memory:
                  $ref: definitions.yaml#/quantityMem
                  default: 2Gi
          required:
            - limits
            - requests
        kanikoTask:
          type: object
          properties:
            requests:
              type: object
              properties:
                cpu:
                  $ref: definitions.yaml#/quantityCpu
                  default: 200m
                memory:
                  $ref: definitions.yaml#/quantityMem
                  default: 128Mi
            limits:
              type: object
              properties:
                cpu:
                  $ref: definitions.yaml#/quantityCpu
                  default: '2'
                memory:
                  $ref: definitions.yaml#/quantityMem
                  default: 2Gi
          required:
            - limits
            - requests
        tektonDashboard:
          type: object
          properties:
            requests:
              type: object
              properties:
                cpu:
                  $ref: definitions.yaml#/quantityCpu
                  default: 10m
                memory:
                  $ref: definitions.yaml#/quantityMem
                  default: 64Mi
            limits:
              type: object
              properties:
                cpu:
                  $ref: definitions.yaml#/quantityCpu
                  default: 100m
                memory:
                  $ref: definitions.yaml#/quantityMem
                  default: 128Mi
          required:
            - limits
            - requests
    alerts:
      $ref: definitions.yaml#/alerts
    resourceQuota:
      $ref: definitions.yaml#/resourceQuota
    networkPolicy:
      title: Network policies
      properties:
        ingressPrivate:
          title: Ingress control
          description: When enabled Team Workloads will be bound by ingress network policies. Turning this off introduces a security risk!
          type: boolean
          default: true
        egressPublic:
          title: Egress control
          description: When enabled all egress traffic will be limited to pre-defined endpoints. Turning this off introduces a security risk!
          type: boolean
          default: true
      type: object
    selfService:
      $ref: team.yaml#/TeamSelfService
  required:
    - name
  x-acl:
    admin:
      - delete-any
      - read-any
      - create-any
      - update-any
    team:
      - read-any
      - update
  type: object
  x-externalDocsPath: docs/for-ops/console/teams
