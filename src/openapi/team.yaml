idName: &idNameField
  type: string
  pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$

TeamSelfService:
  title: Team self service flags
  description: Grant team permissions to modify certain configuration parameters.
  type: object
  properties:
    Service:
      title: Service
      type: array
      items:
        type: string
        enum: [ingress]
      uniqueItems: true
    Team:
      title: Team
      type: array
      items:
        type: string
        enum: [alerts, oidc, resourceQuota]
      uniqueItems: true

Team:
  properties:
    id:
      <<: *idNameField
      title: ID
    name:
      <<: *idNameField
      title: Name
      description: A team name
    oidc:
      properties:
        groupMapping:
          description: An OIDC group name/id granting access to this team
          title: Group mapping
          type: string
      title: OIDC
      type: object
    password:
      type: string
      writeOnly: true
    alerts:
      properties:
        email:
          properties:
            critical:
              description: Email addresses (comma separated) for critical events.
              title: Criticals
              type: string
            nonCritical:
              description: One or more email addresses (comma separated) for non-critical events.
              title: Non criticals
              type: string
          title: Email
          type: object
        msteams:
          properties:
            highPrio:
              description: The high prio web hook
              title: High prio webhook
              type: string
            lowPrio:
              description: The low prio web hook
              title: Low prio webhook
              type: string
          title: Microsoft Teams
          type: object
        receivers:
          items:
            enum:
              - slack
              - msteams
              - email
            type: string
          title: Receivers
          type: array
          uniqueItems: true
        slack:
          properties:
            channel:
              description: Slack channel for non-criticals. If none is given the global one is used, which defaults to 'mon-otomi'.
              title: Channel for non-criticals
              type: string
            channelCrit:
              description: Slack channel for critical alerts. If none is given the global one is used, which defaults to 'mon-otomi-crit'.
              title: Channel for criticals
              type: string
            url:
              description: Slack web hook. If none is given the global one is used.
              title: Web hook
              type: string
          title: Slack
          type: object
      title: Alerting endpoints
      type: object
    azureMonitor:
      $ref: definitions.yaml#/azureMonitor
    selfService:
      $ref: team.yaml#/TeamSelfService
  required:
    - name
  type: object
  x-acl:
    admin:
      - delete-any
      - read-any
      - create-any
      - update-any
    team:
      - read-any
      - update
  x-externalDocsPath: docs/configuring-teams
