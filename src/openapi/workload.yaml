Workload:
  x-acl:
    platformAdmin:
      - create-any
      - read-any
      - update-any
      - delete-any
    teamAdmin:
      - create
      - read
      - update
      - delete
    teamMember:
      - create
      - read
      - update
      - delete
  type: object
  description: Define the location of the Workloads's manifests or Helm chart.
  properties:
    id:
      type: string
    teamId:
      $ref: 'definitions.yaml#/idName'
    name:
      title: Name
      $ref: 'definitions.yaml#/idName'
    icon:
      $ref: 'definitions.yaml#/wordCharacterPattern'
    url:
      description: URL to either Helm or Git repository
      $ref: 'definitions.yaml#/url'
    chartProvider:
      type: string
      title: Chart provider
      enum: ['helm', 'git']
      default: git
    path:
      description: A relative directory path within the Git repository. Absolute paths cause errors. (only valid for applications sourced from Git).
      $ref: 'definitions.yaml#/wordCharacterPattern'
    chart:
      description: Chart is a Helm chart name, and must be specified for applications sourced from a Helm repo.
      $ref: 'definitions.yaml#/wordCharacterPattern'
    revision:
      description: In case of Git, this can be commit, tag, or branch. If omitted, will equal to main. In case of Helm, this is a semver tag for the Chart's version.
      $ref: 'definitions.yaml#/wordCharacterPattern'
      default: main
    chartMetadata:
      title: Chart metadata
      properties:
        helmChartVersion:
          type: string
          title: Helm chart version
          default: ''
        helmChartDescription:
          type: string
          title: Helm chart description
          default: ''
    namespace:
      description: Workload namespace. Applicable only for team-admin. Default value is 'team-<team_id>'.
      $ref: 'definitions.yaml#/idName'
    createNamespace:
      title: Create a new namespace
      type: boolean
      default: false
    sidecarInject:
      title: Enable istio sidecar injection
      type: boolean
      default: false
    imageUpdateStrategy:
      description: Automatically update the image. Only supported when the image is stored in Harbor.
      title: Auto Image Updater
      type: object
      oneOf:
        - title: Disabled
          x-hideTitle: true
          type: object
          properties:
            type:
              type: string
              enum:
                - disabled
              default: disabled
        - title: digest
          type: object
          x-hideTitle: true
          description: Update to the most recent pushed version of a given tag.
          properties:
            digest:
              additionalProperties: false
              type: object
              title: Digest
              properties:
                imageRepository:
                  type: string
                  description: The image repository name.
                  $ref: 'definitions.yaml#/wordCharacterPattern'
                tag:
                  description: Tag of the build.
                  type: string
                  default: latest
                  $ref: 'definitions.yaml#/wordCharacterPattern'
                imageParameter:
                  type: string
                  default: image.repository
                tagParameter:
                  type: string
                  default: image.tag
              required:
                - imageRepository
                - tag
            type:
              type: string
              enum:
                - digest
              default: digest
        - title: semver
          x-hideTitle: true
          type: object
          description: Update to a semantic version.
          properties:
            semver:
              additionalProperties: false
              type: object
              title: Semver
              properties:
                imageRepository:
                  type: string
                  description: The container image repository name.
                  $ref: 'definitions.yaml#/wordCharacterPattern'
                versionConstraint:
                  type: string
                  default: 'v1.0'
                  description: 'Example: v1.0 would allow the image to be updated to any patch version within the v1.0 minor release.'
                  $ref: 'definitions.yaml#/wordCharacterPattern'
                imageParameter:
                  type: string
                  default: image.repository
                tagParameter:
                  type: string
                  default: image.tag
              required:
                - imageRepository
                - versionConstraint
            type:
              type: string
              enum:
                - semver
              default: semver
  required:
    - name
    - url

WorkloadValues:
  x-acl:
    platformAdmin: [read-any, update-any]
    teamAdmin: [read, update]
    teamMember: [read, update]
  type: object
  properties:
    id:
      type: string
    teamId:
      $ref: 'definitions.yaml#/idName'
    name:
      $ref: 'definitions.yaml#/idName'
    values:
      oneOf:
        - type: object
        - type: string
  required:
    - values

AplWorkloadSpec:
  type: object
  description: Define the location of the Workloads's manifests or Helm chart.
  properties:
    icon:
      $ref: 'definitions.yaml#/wordCharacterPattern'
    url:
      description: URL to either Helm or Git repository
      $ref: 'definitions.yaml#/url'
    chartProvider:
      type: string
      title: Chart provider
      enum: ['helm', 'git']
      default: git
    path:
      description: A relative directory path within the Git repository. Absolute paths cause errors. (only valid for applications sourced from Git).
      $ref: 'definitions.yaml#/wordCharacterPattern'
    chart:
      description: Chart is a Helm chart name, and must be specified for applications sourced from a Helm repo.
      $ref: 'definitions.yaml#/wordCharacterPattern'
    revision:
      description: In case of Git, this can be commit, tag, or branch. If omitted, will equal to HEAD. In case of Helm, this is a semver tag for the Chart's version.
      $ref: 'definitions.yaml#/wordCharacterPattern'
      default: main
    chartMetadata:
      title: Chart metadata
      properties:
        helmChartVersion:
          type: string
          title: Helm chart version
          default: ''
        helmChartDescription:
          type: string
          title: Helm chart description
          default: ''
    namespace:
      description: Workload namespace. Applicable only for team-admin. Default value is 'team-<team_id>'.
      $ref: 'definitions.yaml#/idName'
    createNamespace:
      title: Create a new namespace
      type: boolean
      default: false
    sidecarInject:
      title: Enable istio sidecar injection
      type: boolean
      default: false
    imageUpdateStrategy:
      description: Automatically update the image. Only supported when the image is stored in Harbor.
      title: Auto Image Updater
      type: object
      oneOf:
        - title: Disabled
          x-hideTitle: true
          type: object
          properties:
            type:
              type: string
              enum:
                - disabled
              default: disabled
        - title: digest
          type: object
          x-hideTitle: true
          description: Update to the most recent pushed version of a given tag.
          properties:
            digest:
              additionalProperties: false
              type: object
              title: Digest
              properties:
                imageRepository:
                  type: string
                  description: The image repository name.
                  $ref: 'definitions.yaml#/wordCharacterPattern'
                tag:
                  description: Tag of the build.
                  type: string
                  default: latest
                  $ref: 'definitions.yaml#/wordCharacterPattern'
                imageParameter:
                  type: string
                  default: image.repository
                tagParameter:
                  type: string
                  default: image.tag
              required:
                - imageRepository
                - tag
            type:
              type: string
              enum:
                - digest
              default: digest
        - title: semver
          x-hideTitle: true
          type: object
          description: Update to a semantic version.
          properties:
            semver:
              additionalProperties: false
              type: object
              title: Semver
              properties:
                imageRepository:
                  type: string
                  description: The container image repository name.
                  $ref: 'definitions.yaml#/wordCharacterPattern'
                versionConstraint:
                  type: string
                  default: 'v1.0'
                  description: 'Example: v1.0 would allow the image to be updated to any patch version within the v1.0 minor release.'
                  $ref: 'definitions.yaml#/wordCharacterPattern'
                imageParameter:
                  type: string
                  default: image.repository
                tagParameter:
                  type: string
                  default: image.tag
              required:
                - imageRepository
                - versionConstraint
            type:
              type: string
              enum:
                - semver
              default: semver
    values:
      type: string
  required:
    - url
